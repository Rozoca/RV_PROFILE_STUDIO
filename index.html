<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RV Profile Studio | Professional CV Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #fafaf9;
            --bg-secondary: #ffffff;
            --bg-accent: #1c1917;
            --text-primary: #1c1917;
            --text-secondary: #57534e;
            --text-muted: #a8a29e;
            --accent-gold: #b8860b;
            --accent-gold-light: #d4a846;
            --accent-copper: #a0522d;
            --border: #e7e5e4;
            --border-dark: #d6d3d1;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
        }

        [data-theme="dark"] {
            --bg-primary: #0c0a09;
            --bg-secondary: #1c1917;
            --bg-accent: #fafaf9;
            --text-primary: #fafaf9;
            --text-secondary: #a8a29e;
            --text-muted: #78716c;
            --border: #292524;
            --border-dark: #44403c;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.2);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.3);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Source Sans 3', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.7;
            font-size: 16px;
            transition: background 0.3s, color 0.3s;
        }

        h1, h2, h3, .serif {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-weight: 500;
        }

        .header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo { display: flex; align-items: center; gap: 16px; }

        .logo-mark {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-copper) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .logo-text h1 { font-size: 1.4rem; font-weight: 600; letter-spacing: -0.5px; }
        .logo-text span { font-size: 0.75rem; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; }

        .header-controls { display: flex; align-items: center; gap: 16px; }

        .lang-selector {
            display: flex;
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 4px;
            border: 1px solid var(--border);
        }

        .lang-btn {
            padding: 8px 14px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .lang-btn:hover { color: var(--text-primary); }
        .lang-btn.active {
            background: var(--bg-secondary);
            color: var(--accent-gold);
            box-shadow: var(--shadow-sm);
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .theme-toggle:hover { border-color: var(--accent-gold); }

        .main-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        .hero { text-align: center; margin-bottom: 60px; }
        .hero h2 { font-size: 2.8rem; font-weight: 500; margin-bottom: 16px; letter-spacing: -1px; }
        .hero p { color: var(--text-secondary); font-size: 1.15rem; max-width: 600px; margin: 0 auto; }

        .phase-tabs { display: flex; justify-content: center; gap: 8px; margin-bottom: 48px; }

        .phase-tab {
            padding: 16px 32px;
            border: 2px solid var(--border);
            background: var(--bg-secondary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .phase-tab:hover { border-color: var(--border-dark); }
        .phase-tab.active {
            border-color: var(--accent-gold);
            background: linear-gradient(135deg, rgba(184,134,11,0.05) 0%, rgba(160,82,45,0.05) 100%);
        }

        .phase-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .phase-tab.active .phase-number { background: var(--accent-gold); color: white; }
        .phase-tab.completed .phase-number { background: var(--success); color: white; }

        .phase-info h3 { font-family: 'Source Sans 3', sans-serif; font-size: 0.95rem; font-weight: 600; text-align: left; }
        .phase-info span { font-size: 0.8rem; color: var(--text-muted); }

        .panel { display: none; animation: fadeUp 0.4s ease; }
        .panel.active { display: block; }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; }
        .card-title { display: flex; gap: 16px; }
        .card-icon { font-size: 1.5rem; }
        .card-title h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 4px; }
        .card-title span { font-size: 0.9rem; color: var(--text-muted); }

        .btn-ghost {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: transparent;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .btn-ghost:hover { border-color: var(--accent-gold); color: var(--accent-gold); }

        .sector-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }

        .sector-option {
            padding: 14px 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .sector-option:hover { border-color: var(--border-dark); }
        .sector-option.active { border-color: var(--accent-gold); background: rgba(184,134,11,0.05); }
        .sector-option .icon { font-size: 1.4rem; display: block; margin-bottom: 6px; }
        .sector-option .name { font-size: 0.8rem; color: var(--text-secondary); }
        .sector-option.active .name { color: var(--accent-gold); font-weight: 600; }

        .level-pills { display: flex; gap: 12px; }

        .level-pill {
            flex: 1;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .level-pill:hover { border-color: var(--border-dark); }
        .level-pill.active { border-color: var(--accent-gold); background: rgba(184,134,11,0.05); }
        .level-pill .label { font-size: 0.95rem; font-weight: 600; display: block; margin-bottom: 4px; }
        .level-pill .years { font-size: 0.8rem; color: var(--text-muted); }
        .level-pill.active .label { color: var(--accent-gold); }

        .text-input-wrapper { position: relative; }

        .text-input-wrapper textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-family: 'Source Sans 3', sans-serif;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s;
        }

        .text-input-wrapper textarea:focus { outline: none; border-color: var(--accent-gold); }
        .char-count { position: absolute; bottom: 12px; right: 16px; font-size: 0.8rem; color: var(--text-muted); }

        .api-toggle { display: flex; gap: 16px; align-items: center; padding: 20px; background: var(--bg-primary); border-radius: 12px; }

        .toggle-switch {
            width: 52px;
            height: 28px;
            background: var(--border-dark);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active { background: var(--accent-gold); }
        .toggle-switch.active::after { transform: translateX(24px); }

        .api-input {
            margin-top: 16px;
            display: none;
        }

        .api-input.visible { display: block; }

        .api-input input {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: 'Source Sans 3', sans-serif;
            font-size: 0.95rem;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .api-input input:focus { outline: none; border-color: var(--accent-gold); }

        .action-bar {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 32px;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-family: 'Source Sans 3', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-copper) 100%);
            color: white;
        }

        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(184,134,11,0.3); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover { border-color: var(--accent-gold); color: var(--accent-gold); }

        /* Results Section */
        .results-section {
            opacity: 0;
            transform: translateY(40px);
            transition: all 0.6s ease;
            pointer-events: none;
        }

        .results-section.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }

        .score-hero {
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg, rgba(184,134,11,0.08) 0%, rgba(160,82,45,0.05) 100%);
            border-radius: 20px;
            margin-bottom: 32px;
            border: 1px solid var(--border);
        }

        .score-value {
            font-family: 'Cormorant Garamond', serif;
            font-size: 6rem;
            font-weight: 700;
            color: var(--accent-gold);
            line-height: 1;
        }

        .score-label { font-size: 1.2rem; color: var(--text-secondary); margin-top: 8px; }

        .score-meta { display: flex; justify-content: center; gap: 24px; margin-top: 16px; }
        .meta-item { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
        .meta-dot { width: 10px; height: 10px; border-radius: 50%; }
        .meta-dot.success { background: var(--success); }
        .meta-dot.warning { background: var(--warning); }
        .meta-dot.danger { background: var(--danger); }

        /* Score Explanation - NEW v6.0 */
        .score-explanation {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
            text-align: left;
        }

        .score-explanation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding-bottom: 12px;
        }

        .score-explanation-header h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .score-explanation-toggle {
            font-size: 1.2rem;
            color: var(--text-muted);
            transition: transform 0.3s;
        }

        .score-explanation.expanded .score-explanation-toggle {
            transform: rotate(180deg);
        }

        .score-explanation-content {
            display: none;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .score-explanation.expanded .score-explanation-content {
            display: block;
        }

        .scoring-factors {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .scoring-factor {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: 8px;
        }

        .scoring-factor-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(184,134,11,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .scoring-factor-text h5 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .scoring-factor-text p {
            font-size: 0.8rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .disclaimer-box {
            background: rgba(217, 119, 6, 0.1);
            border: 1px solid rgba(217, 119, 6, 0.3);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            gap: 12px;
        }

        .disclaimer-box .icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .disclaimer-box p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .disclaimer-box strong {
            color: var(--warning);
        }

        .executive-summary {
            background: linear-gradient(135deg, rgba(184,134,11,0.05) 0%, transparent 100%);
            border: 2px solid var(--accent-gold);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .summary-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .summary-title { font-size: 1.3rem; font-weight: 600; color: var(--accent-gold); }
        .summary-content { font-size: 1rem; line-height: 1.8; color: var(--text-secondary); }

        .competency-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; align-items: center; }
        .radar-container { height: 280px; }

        .competency-bars { display: flex; flex-direction: column; gap: 16px; }

        .comp-item { display: flex; align-items: center; gap: 16px; }
        .comp-name { width: 100px; font-size: 0.9rem; font-weight: 500; }
        .comp-bar { flex: 1; height: 12px; background: var(--bg-primary); border-radius: 6px; overflow: hidden; }
        .comp-fill { height: 100%; border-radius: 6px; transition: width 1s ease; }
        .comp-fill.excellent { background: linear-gradient(90deg, var(--success), #10b981); }
        .comp-fill.good { background: linear-gradient(90deg, var(--accent-gold), var(--accent-gold-light)); }
        .comp-fill.moderate { background: linear-gradient(90deg, var(--warning), #fbbf24); }
        .comp-fill.low { background: linear-gradient(90deg, var(--danger), #f87171); }
        .comp-score { width: 45px; text-align: right; font-weight: 600; font-size: 0.9rem; }

        .swot-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }

        .swot-box { padding: 24px; border-radius: 12px; }
        .swot-box.strengths { background: rgba(5, 150, 105, 0.08); border: 1px solid rgba(5, 150, 105, 0.2); }
        .swot-box.weaknesses { background: rgba(220, 38, 38, 0.08); border: 1px solid rgba(220, 38, 38, 0.2); }
        .swot-box.opportunities { background: rgba(184, 134, 11, 0.08); border: 1px solid rgba(184, 134, 11, 0.2); }
        .swot-box.threats { background: rgba(120, 113, 108, 0.08); border: 1px solid rgba(120, 113, 108, 0.2); }

        .swot-title { font-weight: 600; margin-bottom: 12px; font-size: 1rem; }
        .swot-box.strengths .swot-title { color: var(--success); }
        .swot-box.weaknesses .swot-title { color: var(--danger); }
        .swot-box.opportunities .swot-title { color: var(--accent-gold); }
        .swot-box.threats .swot-title { color: var(--text-muted); }

        .swot-list { list-style: none; }
        .swot-list li { padding: 6px 0; font-size: 0.9rem; color: var(--text-secondary); padding-left: 20px; position: relative; }
        .swot-list li::before { content: '‚Ä¢'; position: absolute; left: 0; color: var(--text-muted); }

        .keywords-section { margin-bottom: 20px; }
        .keywords-section:last-child { margin-bottom: 0; }
        .keywords-label { font-weight: 600; margin-bottom: 10px; font-size: 0.9rem; color: var(--text-secondary); }

        .keywords-container { display: flex; flex-wrap: wrap; gap: 8px; }

        .keyword-tag {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .keyword-tag.golden { background: rgba(184,134,11,0.15); color: var(--accent-gold); border: 1px solid var(--accent-gold); }
        .keyword-tag.found { background: rgba(5, 150, 105, 0.1); color: var(--success); }
        .keyword-tag.missing { background: rgba(220, 38, 38, 0.1); color: var(--danger); }

        /* Recommendations Section - v6.0 Enhanced */
        .recommendations-container { display: flex; flex-direction: column; gap: 16px; }

        .rec-category {
            margin-bottom: 24px;
        }

        .rec-category-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 16px;
        }

        .rec-category-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .rec-category-header.training .rec-category-icon { background: rgba(59, 130, 246, 0.1); }
        .rec-category-header.certification .rec-category-icon { background: rgba(139, 92, 246, 0.1); }
        .rec-category-header.cv-improvement .rec-category-icon { background: rgba(236, 72, 153, 0.1); }
        .rec-category-header.consultancy .rec-category-icon { background: linear-gradient(135deg, rgba(184,134,11,0.2), rgba(160,82,45,0.2)); }

        .rec-category-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .recommendation-item {
            display: flex;
            gap: 16px;
            padding: 16px;
            border-radius: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            margin-bottom: 12px;
        }

        .rec-priority {
            width: 4px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .rec-priority.critical { background: var(--danger); }
        .rec-priority.high { background: var(--warning); }
        .rec-priority.medium { background: var(--accent-gold); }
        .rec-priority.low { background: var(--success); }

        .rec-content h4 { font-size: 0.95rem; font-weight: 600; margin-bottom: 6px; }
        .rec-content p { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }

        /* CTA Consultancy Box - NEW v6.0 */
        .consultancy-cta {
            background: linear-gradient(135deg, rgba(184,134,11,0.1) 0%, rgba(160,82,45,0.08) 100%);
            border: 2px solid var(--accent-gold);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin-top: 32px;
        }

        .consultancy-cta-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-copper) 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .consultancy-cta h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--accent-gold);
        }

        .consultancy-cta p {
            color: var(--text-secondary);
            margin-bottom: 24px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .consultancy-features {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .consultancy-feature {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .consultancy-feature .check {
            color: var(--success);
            font-weight: bold;
        }

        .btn-cta {
            padding: 16px 40px;
            background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-copper) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .btn-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(184,134,11,0.4);
        }

        #continueToPhase2 { display: flex; }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-overlay.visible { display: flex; }

        .loading-content {
            background: var(--bg-secondary);
            padding: 48px;
            border-radius: 20px;
            text-align: center;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .footer {
            text-align: center;
            padding: 40px;
            border-top: 1px solid var(--border);
            margin-top: 60px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .footer a { color: var(--accent-gold); text-decoration: none; }

        @media (max-width: 768px) {
            .header { padding: 16px 20px; }
            .main-container { padding: 30px 20px; }
            .hero h2 { font-size: 2rem; }
            .phase-tabs { flex-direction: column; }
            .sector-grid { grid-template-columns: repeat(2, 1fr); }
            .level-pills { flex-wrap: wrap; }
            .competency-grid { grid-template-columns: 1fr; }
            .swot-grid { grid-template-columns: 1fr; }
            .scoring-factors { grid-template-columns: 1fr; }
            .consultancy-features { flex-direction: column; align-items: center; gap: 12px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-mark">RV</div>
            <div class="logo-text">
                <h1>Profile Studio</h1>
                <span>v6.0 Professional</span>
            </div>
        </div>
        <div class="header-controls">
            <div class="lang-selector">
                <button class="lang-btn active" onclick="setLanguage('es')">ES</button>
                <button class="lang-btn" onclick="setLanguage('en')">EN</button>
                <button class="lang-btn" onclick="setLanguage('pt')">PT</button>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
        </div>
    </header>

    <main class="main-container">
        <div class="hero">
            <h2 data-i18n="hero_title">Analiza tu perfil profesional</h2>
            <p data-i18n="hero_subtitle">Obt√©n un diagn√≥stico detallado de tu CV con recomendaciones estrat√©gicas personalizadas</p>
        </div>

        <div class="phase-tabs">
            <div class="phase-tab active" onclick="goToPhase(1)" id="tab1">
                <div class="phase-number">1</div>
                <div class="phase-info">
                    <h3 data-i18n="phase1_title">An√°lisis de Perfil</h3>
                    <span data-i18n="phase1_desc">Eval√∫a tu CV</span>
                </div>
            </div>
            <div class="phase-tab" onclick="goToPhase(2)" id="tab2">
                <div class="phase-number">2</div>
                <div class="phase-info">
                    <h3 data-i18n="phase2_title">Job Fit</h3>
                    <span data-i18n="phase2_desc">Compara con ofertas</span>
                </div>
            </div>
        </div>

        <!-- Phase 1 -->
        <div class="panel active" id="phase1">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üéØ</div>
                        <div>
                            <h3 data-i18n="context_title">Contexto profesional</h3>
                            <span data-i18n="context_desc">Selecciona tu sector e industria</span>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 14px; font-size: 0.9rem;" data-i18n="sector_label">Sector / Industria</label>
                    <div class="sector-grid" id="sectorGrid">
                        <div class="sector-option" data-sector="finance" onclick="selectSector(this)">
                            <span class="icon">üè¶</span>
                            <span class="name" data-i18n="sector_finance">Finanzas / Banca</span>
                        </div>
                        <div class="sector-option" data-sector="tech" onclick="selectSector(this)">
                            <span class="icon">üíª</span>
                            <span class="name" data-i18n="sector_tech">Tecnolog√≠a</span>
                        </div>
                        <div class="sector-option" data-sector="consulting" onclick="selectSector(this)">
                            <span class="icon">üìä</span>
                            <span class="name" data-i18n="sector_consulting">Consultor√≠a</span>
                        </div>
                        <div class="sector-option" data-sector="pmo" onclick="selectSector(this)">
                            <span class="icon">üìã</span>
                            <span class="name" data-i18n="sector_pmo">PMO / Proyectos</span>
                        </div>
                        <div class="sector-option" data-sector="transformation" onclick="selectSector(this)">
                            <span class="icon">üîÑ</span>
                            <span class="name" data-i18n="sector_transformation">Transformaci√≥n</span>
                        </div>
                        <div class="sector-option" data-sector="supply" onclick="selectSector(this)">
                            <span class="icon">üì¶</span>
                            <span class="name" data-i18n="sector_supply">Supply Chain</span>
                        </div>
                        <div class="sector-option" data-sector="marketing" onclick="selectSector(this)">
                            <span class="icon">üì±</span>
                            <span class="name" data-i18n="sector_marketing">Marketing</span>
                        </div>
                        <div class="sector-option" data-sector="hr" onclick="selectSector(this)">
                            <span class="icon">üë•</span>
                            <span class="name" data-i18n="sector_hr">RRHH</span>
                        </div>
                        <div class="sector-option" data-sector="legal" onclick="selectSector(this)">
                            <span class="icon">‚öñÔ∏è</span>
                            <span class="name" data-i18n="sector_legal">Legal</span>
                        </div>
                        <div class="sector-option" data-sector="health" onclick="selectSector(this)">
                            <span class="icon">üè•</span>
                            <span class="name" data-i18n="sector_health">Salud / Pharma</span>
                        </div>
                        <div class="sector-option" data-sector="general" onclick="selectSector(this)">
                            <span class="icon">üåê</span>
                            <span class="name" data-i18n="sector_general">Otro / General</span>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 28px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 14px; font-size: 0.9rem;" data-i18n="level_label">Nivel profesional</label>
                    <div class="level-pills" id="levelPills">
                        <div class="level-pill" data-level="junior" onclick="selectLevel(this)">
                            <span class="label">Entry / Junior</span>
                            <span class="years" data-i18n="years_0_3">0-3 a√±os</span>
                        </div>
                        <div class="level-pill" data-level="mid" onclick="selectLevel(this)">
                            <span class="label">Mid-Level</span>
                            <span class="years" data-i18n="years_3_7">3-7 a√±os</span>
                        </div>
                        <div class="level-pill" data-level="senior" onclick="selectLevel(this)">
                            <span class="label">Senior / Lead</span>
                            <span class="years" data-i18n="years_7_12">7-12 a√±os</span>
                        </div>
                        <div class="level-pill" data-level="director" onclick="selectLevel(this)">
                            <span class="label">Director / Exec</span>
                            <span class="years" data-i18n="years_12_plus">12+ a√±os</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üìÑ</div>
                        <div>
                            <h3 data-i18n="cv_title">Curr√≠culum Vitae</h3>
                            <span data-i18n="cv_desc">Pega el contenido de tu CV</span>
                        </div>
                    </div>
                    <button class="btn-ghost" onclick="loadExampleCV()" data-i18n="load_example">Cargar ejemplo</button>
                </div>
                <div class="text-input-wrapper">
                    <textarea id="cvInput" placeholder="Pega aqu√≠ el contenido de tu CV..." data-i18n-placeholder="cv_placeholder"></textarea>
                    <span class="char-count"><span id="cvCharCount">0</span> caracteres</span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üß†</div>
                        <div>
                            <h3 data-i18n="analysis_mode">Modo de an√°lisis</h3>
                            <span data-i18n="analysis_mode_desc">Elige entre an√°lisis r√°pido o con IA</span>
                        </div>
                    </div>
                </div>
                <div class="api-toggle">
                    <div class="toggle-switch" id="aiToggle" onclick="toggleAI()"></div>
                    <div>
                        <span style="font-weight: 600;" data-i18n="ai_analysis">An√°lisis con Claude AI</span>
                        <span style="display: block; font-size: 0.85rem; color: var(--text-muted);" data-i18n="ai_analysis_desc">An√°lisis m√°s profundo y contextual (requiere API Key)</span>
                    </div>
                </div>
                <div class="api-input" id="apiInput">
                    <input type="password" id="apiKey" placeholder="sk-ant-api03-..." data-i18n-placeholder="api_placeholder">
                </div>
            </div>

            <div class="action-bar">
                <button class="btn btn-primary" id="analyzeBtn" onclick="analyzeProfile()" disabled>
                    <span data-i18n="analyze_btn">Analizar Perfil</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>

        <!-- Phase 2 -->
        <div class="panel" id="phase2">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üìã</div>
                        <div>
                            <h3 data-i18n="job_title">Descripci√≥n del puesto</h3>
                            <span data-i18n="job_desc">Pega la oferta de trabajo para comparar</span>
                        </div>
                    </div>
                    <button class="btn-ghost" onclick="loadExampleJob()" data-i18n="load_example">Cargar ejemplo</button>
                </div>
                <div class="text-input-wrapper">
                    <textarea id="jobInput" placeholder="Pega aqu√≠ la descripci√≥n del puesto..." data-i18n-placeholder="job_placeholder"></textarea>
                    <span class="char-count"><span id="jobCharCount">0</span> caracteres</span>
                </div>
            </div>

            <div class="action-bar">
                <button class="btn btn-secondary" onclick="goToPhase(1)">
                    <span>‚Üê</span>
                    <span data-i18n="back_btn">Volver</span>
                </button>
                <button class="btn btn-primary" id="compareFitBtn" onclick="analyzeJobFit()" disabled>
                    <span data-i18n="compare_btn">Analizar Adecuaci√≥n</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>

        <!-- Results -->
        <div class="results-section" id="resultsSection">
            <div class="score-hero">
                <div class="score-value" id="mainScore">‚Äî</div>
                <div class="score-label" id="scoreLabel" data-i18n="profile_score">Puntuaci√≥n del Perfil</div>
                <div class="score-meta" id="scoreMeta"></div>

                <!-- NEW v6.0: Score Explanation -->
                <div class="score-explanation" id="scoreExplanation" onclick="toggleScoreExplanation()">
                    <div class="score-explanation-header">
                        <h4>
                            <span>‚ÑπÔ∏è</span>
                            <span data-i18n="how_calculated">¬øC√≥mo calculamos tu puntuaci√≥n?</span>
                        </h4>
                        <span class="score-explanation-toggle">‚ñº</span>
                    </div>
                    <div class="score-explanation-content">
                        <div class="scoring-factors" id="scoringFactors">
                            <!-- Se llenar√° din√°micamente -->
                        </div>
                        <div class="disclaimer-box">
                            <span class="icon">‚ö†Ô∏è</span>
                            <p>
                                <strong data-i18n="disclaimer_title">Aviso importante:</strong>
                                <span data-i18n="disclaimer_text">Esta evaluaci√≥n es una aproximaci√≥n basada en el an√°lisis de palabras clave, competencias detectadas, experiencia profesional y formaci√≥n acad√©mica. Los resultados son orientativos y no constituyen una evaluaci√≥n definitiva de tu perfil. Te recomendamos complementar este an√°lisis con feedback profesional especializado.</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="executive-summary" id="executiveSummary">
                <div class="summary-header">
                    <div class="summary-title" data-i18n="executive_summary">üìã S√≠ntesis Ejecutiva</div>
                    <button class="btn btn-secondary" onclick="downloadPDFReport()">
                        <span>üìÑ</span>
                        <span data-i18n="download_pdf">Descargar PDF</span>
                    </button>
                </div>
                <div class="summary-content" id="summaryContent"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üìä</div>
                        <div>
                            <h3 data-i18n="competencies_title">Competencias</h3>
                            <span data-i18n="competencies_desc">Evaluaci√≥n por √°reas</span>
                        </div>
                    </div>
                </div>
                <div class="competency-grid">
                    <div class="radar-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="competency-bars" id="competencyBars"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üéØ</div>
                        <div>
                            <h3 data-i18n="swot_title">An√°lisis DAFO</h3>
                            <span data-i18n="swot_desc">Fortalezas, debilidades, oportunidades y amenazas</span>
                        </div>
                    </div>
                </div>
                <div class="swot-grid">
                    <div class="swot-box strengths">
                        <div class="swot-title" data-i18n="strengths">Fortalezas</div>
                        <ul class="swot-list" id="strengths"></ul>
                    </div>
                    <div class="swot-box weaknesses">
                        <div class="swot-title" data-i18n="weaknesses">Debilidades</div>
                        <ul class="swot-list" id="weaknesses"></ul>
                    </div>
                    <div class="swot-box opportunities">
                        <div class="swot-title" data-i18n="opportunities">Oportunidades</div>
                        <ul class="swot-list" id="opportunities"></ul>
                    </div>
                    <div class="swot-box threats">
                        <div class="swot-title" data-i18n="threats">Amenazas</div>
                        <ul class="swot-list" id="threats"></ul>
                    </div>
                </div>
            </div>

            <div class="card" id="keywordsCard" style="display: none;">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üîë</div>
                        <div>
                            <h3 data-i18n="keywords_title">Palabras Clave</h3>
                            <span data-i18n="keywords_desc">Coincidencias con la oferta</span>
                        </div>
                    </div>
                </div>
                <div class="keywords-section">
                    <div class="keywords-label">‚≠ê <span data-i18n="golden_keywords">Keywords estrat√©gicas</span></div>
                    <div class="keywords-container" id="goldenKeywords"></div>
                </div>
                <div class="keywords-section">
                    <div class="keywords-label">‚úì <span data-i18n="found_keywords">Encontradas</span></div>
                    <div class="keywords-container" id="foundKeywords"></div>
                </div>
                <div class="keywords-section">
                    <div class="keywords-label">‚úó <span data-i18n="missing_keywords">Ausentes</span></div>
                    <div class="keywords-container" id="missingKeywords"></div>
                </div>
            </div>

            <!-- Recommendations v6.0 - Categorized -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üí°</div>
                        <div>
                            <h3 data-i18n="recommendations_title">Plan de Acci√≥n</h3>
                            <span data-i18n="recommendations_desc">Recomendaciones estrat√©gicas categorizadas</span>
                        </div>
                    </div>
                </div>
                <div class="recommendations-container" id="recommendations"></div>

                <!-- Consultancy CTA - NEW v6.0 -->
                <div class="consultancy-cta" id="consultancyCTA">
                    <div class="consultancy-cta-icon">üéØ</div>
                    <h3 data-i18n="consultancy_title">¬øNecesitas ayuda profesional?</h3>
                    <p data-i18n="consultancy_desc">Lleva tu perfil al siguiente nivel con una sesi√≥n de consultor√≠a personalizada con el equipo RV Profile Studio. An√°lisis en profundidad, optimizaci√≥n de CV y estrategia de posicionamiento profesional.</p>
                    <div class="consultancy-features">
                        <div class="consultancy-feature">
                            <span class="check">‚úì</span>
                            <span data-i18n="feature_1">Revisi√≥n experta de CV</span>
                        </div>
                        <div class="consultancy-feature">
                            <span class="check">‚úì</span>
                            <span data-i18n="feature_2">Optimizaci√≥n ATS</span>
                        </div>
                        <div class="consultancy-feature">
                            <span class="check">‚úì</span>
                            <span data-i18n="feature_3">Estrategia de posicionamiento</span>
                        </div>
                        <div class="consultancy-feature">
                            <span class="check">‚úì</span>
                            <span data-i18n="feature_4">Preparaci√≥n de entrevistas</span>
                        </div>
                    </div>
                    <button class="btn-cta" onclick="requestConsultancy()">
                        <span data-i18n="consultancy_btn">Solicitar Consultor√≠a</span>
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>

            <div class="action-bar" id="continueToPhase2">
                <button class="btn btn-primary" onclick="goToPhase(2)">
                    <span data-i18n="continue_phase2">Comparar con oferta de trabajo</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>RV Profile Studio v6.0 | Desarrollado con ‚ù§Ô∏è por <a href="#">RV</a> | ¬© 2025</p>
    </footer>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p data-i18n="analyzing">Analizando tu perfil...</p>
        </div>
    </div>

    <script>
        // ==================== STATE ====================
        let currentLang = 'es';
        let currentTheme = 'light';
        let selectedSector = null;
        let selectedLevel = null;
        let useAI = false;
        let radarChart = null;
        let lastAnalysisResult = null;
        let lastAnalysisScoring = null; // Para guardar detalles del scoring

        // ==================== TRANSLATIONS v6.0 ====================
        const translations = {
            es: {
                hero_title: 'Analiza tu perfil profesional',
                hero_subtitle: 'Obt√©n un diagn√≥stico detallado de tu CV con recomendaciones estrat√©gicas personalizadas',
                phase1_title: 'An√°lisis de Perfil',
                phase1_desc: 'Eval√∫a tu CV',
                phase2_title: 'Job Fit',
                phase2_desc: 'Compara con ofertas',
                context_title: 'Contexto profesional',
                context_desc: 'Selecciona tu sector e industria',
                sector_label: 'Sector / Industria',
                sector_finance: 'Finanzas / Banca',
                sector_tech: 'Tecnolog√≠a',
                sector_consulting: 'Consultor√≠a',
                sector_pmo: 'PMO / Proyectos',
                sector_transformation: 'Transformaci√≥n',
                sector_supply: 'Supply Chain',
                sector_marketing: 'Marketing',
                sector_hr: 'RRHH',
                sector_legal: 'Legal',
                sector_health: 'Salud / Pharma',
                sector_general: 'Otro / General',
                level_label: 'Nivel profesional',
                years_0_3: '0-3 a√±os',
                years_3_7: '3-7 a√±os',
                years_7_12: '7-12 a√±os',
                years_12_plus: '12+ a√±os',
                cv_title: 'Curr√≠culum Vitae',
                cv_desc: 'Pega el contenido de tu CV',
                load_example: 'Cargar ejemplo',
                cv_placeholder: 'Pega aqu√≠ el contenido de tu CV...',
                analysis_mode: 'Modo de an√°lisis',
                analysis_mode_desc: 'Elige entre an√°lisis r√°pido o con IA',
                ai_analysis: 'An√°lisis con Claude AI',
                ai_analysis_desc: 'An√°lisis m√°s profundo y contextual (requiere API Key)',
                api_placeholder: 'sk-ant-api03-...',
                analyze_btn: 'Analizar Perfil',
                job_title: 'Descripci√≥n del puesto',
                job_desc: 'Pega la oferta de trabajo para comparar',
                job_placeholder: 'Pega aqu√≠ la descripci√≥n del puesto...',
                back_btn: 'Volver',
                compare_btn: 'Analizar Adecuaci√≥n',
                profile_score: 'Puntuaci√≥n del Perfil',
                fit_score: 'Adecuaci√≥n al Puesto',
                executive_summary: 'üìã S√≠ntesis Ejecutiva',
                download_pdf: 'Descargar PDF',
                how_calculated: '¬øC√≥mo calculamos tu puntuaci√≥n?',
                disclaimer_title: 'Aviso importante:',
                disclaimer_text: 'Esta evaluaci√≥n es una aproximaci√≥n basada en el an√°lisis de palabras clave, competencias detectadas, experiencia profesional y formaci√≥n acad√©mica. Los resultados son orientativos y no constituyen una evaluaci√≥n definitiva de tu perfil. Te recomendamos complementar este an√°lisis con feedback profesional especializado.',
                competencies_title: 'Competencias',
                competencies_desc: 'Evaluaci√≥n por √°reas',
                swot_title: 'An√°lisis DAFO',
                swot_desc: 'Fortalezas, debilidades, oportunidades y amenazas',
                strengths: 'Fortalezas',
                weaknesses: 'Debilidades',
                opportunities: 'Oportunidades',
                threats: 'Amenazas',
                keywords_title: 'Palabras Clave',
                keywords_desc: 'Coincidencias con la oferta',
                golden_keywords: 'Keywords estrat√©gicas',
                found_keywords: 'Encontradas',
                missing_keywords: 'Ausentes',
                recommendations_title: 'Plan de Acci√≥n',
                recommendations_desc: 'Recomendaciones estrat√©gicas categorizadas',
                rec_training: 'Formaci√≥n & Idiomas',
                rec_certification: 'Certificaciones',
                rec_cv_improvement: 'Mejora del CV',
                rec_consultancy: 'Consultor√≠a Especializada',
                consultancy_title: '¬øNecesitas ayuda profesional?',
                consultancy_desc: 'Lleva tu perfil al siguiente nivel con una sesi√≥n de consultor√≠a personalizada con el equipo RV Profile Studio. An√°lisis en profundidad, optimizaci√≥n de CV y estrategia de posicionamiento profesional.',
                feature_1: 'Revisi√≥n experta de CV',
                feature_2: 'Optimizaci√≥n ATS',
                feature_3: 'Estrategia de posicionamiento',
                feature_4: 'Preparaci√≥n de entrevistas',
                consultancy_btn: 'Solicitar Consultor√≠a',
                continue_phase2: 'Comparar con oferta de trabajo',
                analyzing: 'Analizando tu perfil...',
                scoring_experience: 'Experiencia Profesional',
                scoring_experience_desc: 'A√±os de experiencia en el sector relevante',
                scoring_technical: 'Competencias T√©cnicas',
                scoring_technical_desc: 'Palabras clave y habilidades t√©cnicas detectadas',
                scoring_education: 'Formaci√≥n Acad√©mica',
                scoring_education_desc: 'T√≠tulos universitarios, masters y certificaciones',
                scoring_languages: 'Idiomas',
                scoring_languages_desc: 'Nivel certificado de idiomas relevantes',
                scoring_leadership: 'Liderazgo',
                scoring_leadership_desc: 'Experiencia en gesti√≥n de equipos y proyectos',
                scoring_soft: 'Soft Skills',
                scoring_soft_desc: 'Habilidades blandas y competencias transversales'
            },
            en: {
                hero_title: 'Analyze your professional profile',
                hero_subtitle: 'Get a detailed diagnosis of your CV with personalized strategic recommendations',
                phase1_title: 'Profile Analysis',
                phase1_desc: 'Evaluate your CV',
                phase2_title: 'Job Fit',
                phase2_desc: 'Compare with job offers',
                context_title: 'Professional context',
                context_desc: 'Select your sector and industry',
                sector_label: 'Sector / Industry',
                sector_finance: 'Finance / Banking',
                sector_tech: 'Technology',
                sector_consulting: 'Consulting',
                sector_pmo: 'PMO / Projects',
                sector_transformation: 'Transformation',
                sector_supply: 'Supply Chain',
                sector_marketing: 'Marketing',
                sector_hr: 'HR',
                sector_legal: 'Legal',
                sector_health: 'Health / Pharma',
                sector_general: 'Other / General',
                level_label: 'Professional level',
                years_0_3: '0-3 years',
                years_3_7: '3-7 years',
                years_7_12: '7-12 years',
                years_12_plus: '12+ years',
                cv_title: 'Curriculum Vitae',
                cv_desc: 'Paste your CV content',
                load_example: 'Load example',
                cv_placeholder: 'Paste your CV content here...',
                analysis_mode: 'Analysis mode',
                analysis_mode_desc: 'Choose between quick or AI analysis',
                ai_analysis: 'Claude AI Analysis',
                ai_analysis_desc: 'Deeper and contextual analysis (requires API Key)',
                api_placeholder: 'sk-ant-api03-...',
                analyze_btn: 'Analyze Profile',
                job_title: 'Job Description',
                job_desc: 'Paste the job offer to compare',
                job_placeholder: 'Paste the job description here...',
                back_btn: 'Back',
                compare_btn: 'Analyze Fit',
                profile_score: 'Profile Score',
                fit_score: 'Job Fit Score',
                executive_summary: 'üìã Executive Summary',
                download_pdf: 'Download PDF',
                how_calculated: 'How do we calculate your score?',
                disclaimer_title: 'Important notice:',
                disclaimer_text: 'This evaluation is an approximation based on keyword analysis, detected competencies, professional experience and academic background. Results are indicative and do not constitute a definitive assessment of your profile. We recommend complementing this analysis with specialized professional feedback.',
                competencies_title: 'Competencies',
                competencies_desc: 'Evaluation by areas',
                swot_title: 'SWOT Analysis',
                swot_desc: 'Strengths, weaknesses, opportunities and threats',
                strengths: 'Strengths',
                weaknesses: 'Weaknesses',
                opportunities: 'Opportunities',
                threats: 'Threats',
                keywords_title: 'Keywords',
                keywords_desc: 'Matches with the job offer',
                golden_keywords: 'Strategic keywords',
                found_keywords: 'Found',
                missing_keywords: 'Missing',
                recommendations_title: 'Action Plan',
                recommendations_desc: 'Categorized strategic recommendations',
                rec_training: 'Training & Languages',
                rec_certification: 'Certifications',
                rec_cv_improvement: 'CV Improvement',
                rec_consultancy: 'Specialized Consultancy',
                consultancy_title: 'Need professional help?',
                consultancy_desc: 'Take your profile to the next level with a personalized consulting session with the RV Profile Studio team. In-depth analysis, CV optimization and professional positioning strategy.',
                feature_1: 'Expert CV review',
                feature_2: 'ATS optimization',
                feature_3: 'Positioning strategy',
                feature_4: 'Interview preparation',
                consultancy_btn: 'Request Consultancy',
                continue_phase2: 'Compare with job offer',
                analyzing: 'Analyzing your profile...',
                scoring_experience: 'Professional Experience',
                scoring_experience_desc: 'Years of experience in the relevant sector',
                scoring_technical: 'Technical Competencies',
                scoring_technical_desc: 'Keywords and technical skills detected',
                scoring_education: 'Academic Background',
                scoring_education_desc: 'University degrees, masters and certifications',
                scoring_languages: 'Languages',
                scoring_languages_desc: 'Certified level of relevant languages',
                scoring_leadership: 'Leadership',
                scoring_leadership_desc: 'Team and project management experience',
                scoring_soft: 'Soft Skills',
                scoring_soft_desc: 'Soft skills and cross-functional competencies'
            },
            pt: {
                hero_title: 'Analise seu perfil profissional',
                hero_subtitle: 'Obtenha um diagn√≥stico detalhado do seu CV com recomenda√ß√µes estrat√©gicas personalizadas',
                phase1_title: 'An√°lise de Perfil',
                phase1_desc: 'Avalie seu CV',
                phase2_title: 'Job Fit',
                phase2_desc: 'Compare com vagas',
                context_title: 'Contexto profissional',
                context_desc: 'Selecione seu setor e ind√∫stria',
                sector_label: 'Setor / Ind√∫stria',
                sector_finance: 'Finan√ßas / Banco',
                sector_tech: 'Tecnologia',
                sector_consulting: 'Consultoria',
                sector_pmo: 'PMO / Projetos',
                sector_transformation: 'Transforma√ß√£o',
                sector_supply: 'Supply Chain',
                sector_marketing: 'Marketing',
                sector_hr: 'RH',
                sector_legal: 'Jur√≠dico',
                sector_health: 'Sa√∫de / Pharma',
                sector_general: 'Outro / Geral',
                level_label: 'N√≠vel profissional',
                years_0_3: '0-3 anos',
                years_3_7: '3-7 anos',
                years_7_12: '7-12 anos',
                years_12_plus: '12+ anos',
                cv_title: 'Curr√≠culo',
                cv_desc: 'Cole o conte√∫do do seu CV',
                load_example: 'Carregar exemplo',
                cv_placeholder: 'Cole o conte√∫do do seu CV aqui...',
                analysis_mode: 'Modo de an√°lise',
                analysis_mode_desc: 'Escolha entre an√°lise r√°pida ou com IA',
                ai_analysis: 'An√°lise com Claude AI',
                ai_analysis_desc: 'An√°lise mais profunda e contextual (requer API Key)',
                api_placeholder: 'sk-ant-api03-...',
                analyze_btn: 'Analisar Perfil',
                job_title: 'Descri√ß√£o da vaga',
                job_desc: 'Cole a oferta de emprego para comparar',
                job_placeholder: 'Cole a descri√ß√£o da vaga aqui...',
                back_btn: 'Voltar',
                compare_btn: 'Analisar Adequa√ß√£o',
                profile_score: 'Pontua√ß√£o do Perfil',
                fit_score: 'Adequa√ß√£o √† Vaga',
                executive_summary: 'üìã S√≠ntese Executiva',
                download_pdf: 'Baixar PDF',
                how_calculated: 'Como calculamos sua pontua√ß√£o?',
                disclaimer_title: 'Aviso importante:',
                disclaimer_text: 'Esta avalia√ß√£o √© uma aproxima√ß√£o baseada em an√°lise de palavras-chave, compet√™ncias detectadas, experi√™ncia profissional e forma√ß√£o acad√™mica. Os resultados s√£o indicativos e n√£o constituem uma avalia√ß√£o definitiva do seu perfil. Recomendamos complementar esta an√°lise com feedback profissional especializado.',
                competencies_title: 'Compet√™ncias',
                competencies_desc: 'Avalia√ß√£o por √°reas',
                swot_title: 'An√°lise SWOT',
                swot_desc: 'For√ßas, fraquezas, oportunidades e amea√ßas',
                strengths: 'For√ßas',
                weaknesses: 'Fraquezas',
                opportunities: 'Oportunidades',
                threats: 'Amea√ßas',
                keywords_title: 'Palavras-Chave',
                keywords_desc: 'Correspond√™ncias com a vaga',
                golden_keywords: 'Keywords estrat√©gicas',
                found_keywords: 'Encontradas',
                missing_keywords: 'Ausentes',
                recommendations_title: 'Plano de A√ß√£o',
                recommendations_desc: 'Recomenda√ß√µes estrat√©gicas categorizadas',
                rec_training: 'Forma√ß√£o & Idiomas',
                rec_certification: 'Certifica√ß√µes',
                rec_cv_improvement: 'Melhoria do CV',
                rec_consultancy: 'Consultoria Especializada',
                consultancy_title: 'Precisa de ajuda profissional?',
                consultancy_desc: 'Leve seu perfil ao pr√≥ximo n√≠vel com uma sess√£o de consultoria personalizada com a equipe RV Profile Studio. An√°lise aprofundada, otimiza√ß√£o de CV e estrat√©gia de posicionamento profissional.',
                feature_1: 'Revis√£o especialista de CV',
                feature_2: 'Otimiza√ß√£o ATS',
                feature_3: 'Estrat√©gia de posicionamento',
                feature_4: 'Prepara√ß√£o para entrevistas',
                consultancy_btn: 'Solicitar Consultoria',
                continue_phase2: 'Comparar com oferta de emprego',
                analyzing: 'Analisando seu perfil...',
                scoring_experience: 'Experi√™ncia Profissional',
                scoring_experience_desc: 'Anos de experi√™ncia no setor relevante',
                scoring_technical: 'Compet√™ncias T√©cnicas',
                scoring_technical_desc: 'Palavras-chave e habilidades t√©cnicas detectadas',
                scoring_education: 'Forma√ß√£o Acad√™mica',
                scoring_education_desc: 'Diplomas universit√°rios, mestrados e certifica√ß√µes',
                scoring_languages: 'Idiomas',
                scoring_languages_desc: 'N√≠vel certificado de idiomas relevantes',
                scoring_leadership: 'Lideran√ßa',
                scoring_leadership_desc: 'Experi√™ncia em gest√£o de equipes e projetos',
                scoring_soft: 'Soft Skills',
                scoring_soft_desc: 'Habilidades interpessoais e compet√™ncias transversais'
            }
        };

        // ==================== UI FUNCTIONS ====================
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === lang.toUpperCase());
            });
            updateTranslations();
        }

        function updateTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    el.textContent = translations[currentLang][key];
                }
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[currentLang][key]) {
                    el.placeholder = translations[currentLang][key];
                }
            });
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme === 'dark' ? 'dark' : '');
            document.querySelector('.theme-toggle').textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function goToPhase(phase) {
            document.querySelectorAll('.phase-tab').forEach((tab, i) => {
                tab.classList.toggle('active', i + 1 === phase);
            });
            document.querySelectorAll('.panel').forEach((panel, i) => {
                panel.classList.toggle('active', i + 1 === phase);
            });
        }

        function selectSector(el) {
            document.querySelectorAll('.sector-option').forEach(o => o.classList.remove('active'));
            el.classList.add('active');
            selectedSector = el.dataset.sector;
            checkReady();
        }

        function selectLevel(el) {
            document.querySelectorAll('.level-pill').forEach(o => o.classList.remove('active'));
            el.classList.add('active');
            selectedLevel = el.dataset.level;
            checkReady();
        }

        function toggleAI() {
            useAI = !useAI;
            document.getElementById('aiToggle').classList.toggle('active', useAI);
            document.getElementById('apiInput').classList.toggle('visible', useAI);
            checkReady();
        }

        function toggleScoreExplanation() {
            const el = document.getElementById('scoreExplanation');
            el.classList.toggle('expanded');
        }

        function checkReady() {
            const cvText = document.getElementById('cvInput').value.trim();
            const jobText = document.getElementById('jobInput').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            
            const phase1Ready = cvText.length > 50 && selectedSector && selectedLevel && (!useAI || apiKey.length > 10);
            document.getElementById('analyzeBtn').disabled = !phase1Ready;
            
            const phase2Ready = jobText.length > 50;
            document.getElementById('compareFitBtn').disabled = !phase2Ready;
        }

        document.getElementById('cvInput').addEventListener('input', function() {
            document.getElementById('cvCharCount').textContent = this.value.length;
            checkReady();
        });

        document.getElementById('jobInput').addEventListener('input', function() {
            document.getElementById('jobCharCount').textContent = this.value.length;
            checkReady();
        });

        document.getElementById('apiKey').addEventListener('input', checkReady);

        function loadExampleCV() {
            const exampleCV = `RODRIGO VIDAL
Project Manager | Payments Expert | Change Management

PERFIL PROFESIONAL
19 a√±os de experiencia progresiva en el sector financiero. Especializado en sistemas de pagos, transformaci√≥n digital y gesti√≥n de proyectos. Actualmente Process Owner de SEPA Instant Payments en ING Espa√±a & Portugal. Liderazgo de comunidades de pr√°ctica y gesti√≥n del cambio en entornos internacionales.

EXPERIENCIA
ING Espa√±a & Portugal | Strategic Process Manager | 2024 - Presente
- Process Owner SEPA Instant Payments
- Fundador y l√≠der del Foro de Expertos en Pagos (57 profesionales, 95% satisfacci√≥n)
- Coordinador proyecto Euro Digital
- Offshoring Manila: reducci√≥n 80% BAU operativo, SLA >95%

BME Group (SIX Group) | Treasury Specialist | 2022 - 2024
- Proyecto ISO20022 TARGET2/CBPR+ para cliente CIB Banking
- Mejora de procesos de tesorer√≠a

Minsait (Indra) | Senior Consultant | 2021 - 2022
- Gesti√≥n proyecto consolidaci√≥n plataforma pagos (+4M EUR)
- Migraci√≥n ISO20022

Telef√≥nica | Product Owner Treasury | 2019 - 2021
- Gesti√≥n +200 cuentas bancarias en 20 entidades
- Proyecto SAP coordinaci√≥n Espa√±a-Holanda

WiZink Bank | Head of Treasury Operations | 2015 - 2019
- Creaci√≥n departamento Back Office desde cero
- Migraci√≥n Iberclear: ahorro ~100K EUR/a√±o

Citibank | Payment Operations Specialist | 2006 - 2015
- Especialista transferencias internacionales SWIFT
- Reconocimiento por identificaci√≥n de fraudes

Armada de Brasil | Oficial Operaciones Log√≠sticas | 1999 - 2006

FORMACI√ìN
M√°ster Project Management | OBS Business School | 2023
Executive MBA | EAE Business School | 2018
Grado Ciencias Pol√≠ticas | Universitat de Barcelona | 2015

CERTIFICACIONES
- Lean Six Sigma (en curso)
- Power BI Data Analysis | Bilib 2024
- SWIFT Training Certification | 2017

IDIOMAS
Espa√±ol: Biling√ºe | Portugu√©s: Nativo | Ingl√©s: B2+ (Trinity College)

COMPETENCIAS
SWIFT, ISO20022, SEPA, Euro Digital, SAP, Lean Management, Change Management, Stakeholder Management, Value Stream Mapping`;

            document.getElementById('cvInput').value = exampleCV;
            document.getElementById('cvCharCount').textContent = exampleCV.length;
            checkReady();
        }

        function loadExampleJob() {
            const exampleJob = `Senior Project Manager - Payments & Digital Transformation
ING Bank - Madrid

About the role:
We are looking for a Senior Project Manager to lead strategic transformation projects in our Payments division. You will work closely with business stakeholders, technology teams, and external partners to deliver complex programs.

Requirements:
- 10+ years experience in project management within financial services
- Strong knowledge of payment systems (SWIFT, SEPA, ISO20022)
- PMP or PRINCE2 certification required
- Experience with digital transformation and change management
- Fluent English (C1 minimum) and Spanish
- Knowledge of Agile/Scrum methodologies
- MBA or Master's degree preferred

Responsibilities:
- Lead end-to-end delivery of payment transformation programs
- Manage budgets up to ‚Ç¨5M and teams of 10+ people
- Stakeholder management at executive level
- Risk management and mitigation strategies
- Drive adoption of new payment solutions`;

            document.getElementById('jobInput').value = exampleJob;
            document.getElementById('jobCharCount').textContent = exampleJob.length;
            checkReady();
        }

        // ==================== MOTOR DE AN√ÅLISIS v6.0 ====================
        const sectorKeywords = {
            finance: ['swift', 'sepa', 'iso20022', 'pagos', 'payments', 'banking', 'banca', 'psd2', 'compliance', 'riesgo', 'treasury', 'tesorer√≠a', 'trading', 'fintech', 'aml', 'kyc', 'instant', 'dora'],
            tech: ['software', 'desarrollo', 'programming', 'agile', 'scrum', 'devops', 'cloud', 'aws', 'python', 'javascript', 'api', 'microservices', 'kubernetes', 'ci/cd', 'java', 'react'],
            consulting: ['estrategia', 'strategy', 'consulting', 'an√°lisis', 'analysis', 'due diligence', 'business case', 'stakeholder', 'transformation', 'cambio', 'change', 'roadmap'],
            pmo: ['pmo', 'project management', 'portfolio', 'programa', 'program', 'pmp', 'prince2', 'pmbok', 'ms project', 'jira', 'gantt', 'wbs', 'stakeholder', 'scope', 'risk', 'budget', 'milestone', 'sprint', 'backlog'],
            transformation: ['transformaci√≥n', 'transformation', 'change management', 'gesti√≥n del cambio', 'reingenier√≠a', 'digitalizaci√≥n', 'digitalization', 'bpm', 'lean', 'six sigma', 'kaizen', 'agile', 'roadmap', 'as-is', 'to-be', 'kpi', 'dashboard'],
            supply: ['supply chain', 'log√≠stica', 'logistics', 'procurement', 'compras', 'inventario', 'inventory', 'warehouse', 'almac√©n', 'transporte', 'transport', 'distribuci√≥n', 'distribution', 'erp', 'sap', 'mrp', 's&op', 'demand planning', 'forecasting', 'lean', 'just in time', 'jit'],
            marketing: ['branding', 'digital marketing', 'seo', 'sem', 'social media', 'content', 'analytics', 'campaign', 'roi', 'engagement', 'leads'],
            hr: ['talento', 'talent', 'recruiting', 'onboarding', 'desarrollo', 'performance', 'engagement', 'cultura', 'compensaci√≥n', 'formaci√≥n'],
            legal: ['compliance', 'regulaci√≥n', 'normativa', 'legal', 'contratos', 'rgpd', 'gdpr', 'audit', 'riesgo', 'governance'],
            health: ['pharma', 'clinical', 'regulatory', 'fda', 'ema', 'medical', 'healthcare', 'trials', 'gmp', 'patient'],
            general: ['gesti√≥n', 'management', 'proyecto', 'project', 'equipo', 'team', 'liderazgo', 'leadership', 'resultados', 'kpi']
        };

        const competencyLabels = {
            es: ['Experiencia', 'T√©cnico', 'Liderazgo', 'Soft Skills', 'Idiomas', 'Formaci√≥n'],
            en: ['Experience', 'Technical', 'Leadership', 'Soft Skills', 'Languages', 'Education'],
            pt: ['Experi√™ncia', 'T√©cnico', 'Lideran√ßa', 'Soft Skills', 'Idiomas', 'Forma√ß√£o']
        };

        function analyzeWithRules(cv, job = null) {
            const cvLower = cv.toLowerCase();
            const sector = selectedSector || 'general';
            const keywords = sectorKeywords[sector] || sectorKeywords.general;
            
            const foundKeywords = keywords.filter(kw => cvLower.includes(kw.toLowerCase()));
            const keywordScore = Math.min(100, (foundKeywords.length / keywords.length) * 140);
            
            // EXPERIENCIA CALIBRADA v6.0
            const yearsMatch = cv.match(/(\d+)\+?\s*(a√±os|years|anos)/i);
            const years = yearsMatch ? parseInt(yearsMatch[1]) : 5;
            
            let experienceBase;
            if (years >= 20) experienceBase = 95;
            else if (years >= 15) experienceBase = 88;
            else if (years >= 12) experienceBase = 82;
            else if (years >= 10) experienceBase = 76;
            else if (years >= 8) experienceBase = 70;
            else if (years >= 6) experienceBase = 62;
            else if (years >= 4) experienceBase = 54;
            else if (years >= 2) experienceBase = 44;
            else experienceBase = 35;
            
            let certBonus = 0;
            if (cvLower.includes('pmp') || cvLower.includes('prince2')) certBonus += 1;
            if (cvLower.includes('safe') || cvLower.includes('scrum master')) certBonus += 1;
            if (cvLower.includes('itil') || cvLower.includes('togaf')) certBonus += 1;
            certBonus = Math.min(certBonus, 3);
            
            const experienceScore = Math.min(98, experienceBase + certBonus);
            
            // FORMACI√ìN
            let educationBase = 35;
            if (cvLower.includes('mba') || cvLower.includes('m√°ster') || cvLower.includes('master')) educationBase += 25;
            if (cvLower.includes('licenciatura') || cvLower.includes('bachelor') || cvLower.includes('grado')) educationBase += 15;
            if (cvLower.includes('doctorado') || cvLower.includes('phd')) educationBase += 20;
            if (cvLower.match(/esade|iese|ie business|harvard|stanford|mit|insead/)) educationBase += 8;
            
            let eduCertBonus = 0;
            if (cvLower.includes('pmp') || cvLower.includes('prince2')) eduCertBonus += 2;
            if (cvLower.includes('lean') || cvLower.includes('six sigma')) eduCertBonus += 2;
            eduCertBonus = Math.min(eduCertBonus, 3);
            
            const educationScore = Math.min(95, educationBase + eduCertBonus);
            
            // Idiomas
            const hasC1C2 = /\b(c1|c2|nativo|native|fluent|biling√ºe|bilingual)\b/i.test(cv);
            const hasB2 = /\bb2\b/i.test(cv);
            const hasB1 = /\bb1\b/i.test(cv);
            const langCount = (cv.match(/\b(ingl√©s|english|franc√©s|french|alem√°n|german|portugu√™s|portuguese|italiano|italian|chino|chinese)\b/gi) || []).length;
            
            let languageScore = 30;
            if (hasC1C2) languageScore += 40;
            else if (hasB2) languageScore += 25;
            else if (hasB1) languageScore += 15;
            languageScore += Math.min(30, langCount * 10);
            languageScore = Math.min(100, languageScore);
            
            // Liderazgo
            const leaderKeywords = ['l√≠der', 'leader', 'manager', 'director', 'coordinador', 'coordinator', 'equipo', 'team', 'gesti√≥n', 'management', 'personas', 'people'];
            const leaderFound = leaderKeywords.filter(k => cvLower.includes(k)).length;
            const leadershipScore = Math.min(100, 25 + leaderFound * 10);
            
            // Soft Skills
            const softKeywords = ['comunicaci√≥n', 'communication', 'negociaci√≥n', 'negotiation', 'resoluci√≥n', 'problem solving', 'colaboraci√≥n', 'collaboration', 'adaptabilidad', 'adaptability'];
            const softFound = softKeywords.filter(k => cvLower.includes(k)).length;
            const softScore = Math.min(100, 30 + softFound * 12);

            const scores = {
                experience: Math.round(experienceScore),
                technical: Math.round(keywordScore),
                leadership: Math.round(leadershipScore),
                soft: Math.round(softScore),
                languages: Math.round(languageScore),
                education: Math.round(educationScore)
            };
            
            const avgScore = Math.round(Object.values(scores).reduce((a,b) => a+b, 0) / 6);

            // Guardar detalles del scoring para explicaci√≥n
            lastAnalysisScoring = {
                years: years,
                foundKeywords: foundKeywords,
                totalKeywords: keywords.length,
                hasC1C2: hasC1C2,
                hasB2: hasB2,
                hasMBA: cvLower.includes('mba') || cvLower.includes('m√°ster') || cvLower.includes('master'),
                hasPMP: cvLower.includes('pmp') || cvLower.includes('prince2'),
                hasLean: cvLower.includes('lean') || cvLower.includes('six sigma')
            };

            // DAFO
            const swot = { strengths: [], weaknesses: [], opportunities: [], threats: [] };
            
            if (scores.experience >= 70) swot.strengths.push(currentLang === 'en' ? 'Solid professional track record' : currentLang === 'pt' ? 'Trajet√≥ria profissional s√≥lida' : 'Trayectoria profesional consolidada');
            if (scores.technical >= 70) swot.strengths.push(currentLang === 'en' ? 'Strong technical expertise' : currentLang === 'pt' ? 'Forte expertise t√©cnica' : 'S√≥lida especializaci√≥n t√©cnica');
            if (scores.leadership >= 70) swot.strengths.push(currentLang === 'en' ? 'Proven team leadership' : currentLang === 'pt' ? 'Lideran√ßa de equipes comprovada' : 'Liderazgo de equipos demostrado');
            if (scores.education >= 75) swot.strengths.push(currentLang === 'en' ? 'Strong academic background' : currentLang === 'pt' ? 'Forte forma√ß√£o acad√™mica' : 'S√≥lida formaci√≥n acad√©mica');
            
            if (scores.languages < 80) {
                swot.weaknesses.push(currentLang === 'en' ? 'Language certifications could be strengthened (C1/C2 recommended)' : currentLang === 'pt' ? 'Certifica√ß√µes de idiomas podem ser fortalecidas (C1/C2 recomendado)' : 'Certificaciones de idiomas mejorables (C1/C2 recomendable)');
            }
            if (!cvLower.includes('pmp') && !cvLower.includes('prince2') && !cvLower.includes('safe')) {
                swot.weaknesses.push(currentLang === 'en' ? 'No project management certifications detected (PMP, PRINCE2, SAFe)' : currentLang === 'pt' ? 'Certifica√ß√µes de gest√£o de projetos n√£o detectadas (PMP, PRINCE2, SAFe)' : 'No se detectan certificaciones de gesti√≥n de proyectos (PMP, PRINCE2, SAFe)');
            }
            if (!cvLower.includes('lean') && !cvLower.includes('six sigma')) {
                swot.weaknesses.push(currentLang === 'en' ? 'No Lean/Six Sigma methodology mentioned' : currentLang === 'pt' ? 'Metodologia Lean/Six Sigma n√£o mencionada' : 'No se menciona metodolog√≠a Lean/Six Sigma');
            }
            if (scores.soft < 65) {
                swot.weaknesses.push(currentLang === 'en' ? 'Soft skills could be better highlighted' : currentLang === 'pt' ? 'Soft skills poderiam ser melhor destacadas' : 'Las soft skills podr√≠an destacarse m√°s');
            }
            if (!cvLower.includes('internacional') && !cvLower.includes('international') && !cvLower.includes('global')) {
                swot.weaknesses.push(currentLang === 'en' ? 'Limited international exposure visible' : currentLang === 'pt' ? 'Exposi√ß√£o internacional limitada vis√≠vel' : 'Exposici√≥n internacional limitada visible');
            }
            
            if (swot.weaknesses.length < 2) {
                swot.weaknesses.push(currentLang === 'en' ? 'CV could include more quantified achievements' : currentLang === 'pt' ? 'CV poderia incluir mais conquistas quantificadas' : 'El CV podr√≠a incluir m√°s logros cuantificados');
            }
            
            swot.opportunities.push(currentLang === 'en' ? 'Digital transformation demand is growing' : currentLang === 'pt' ? 'Demanda por transforma√ß√£o digital em crescimento' : 'Demanda de transformaci√≥n digital en crecimiento');
            swot.opportunities.push(currentLang === 'en' ? 'New regulations create expert demand (DORA, PSD3)' : currentLang === 'pt' ? 'Novas regula√ß√µes criam demanda por especialistas (DORA, PSD3)' : 'Nuevas regulaciones crean demanda de expertos (DORA, PSD3)');
            if (scores.experience >= 60) swot.opportunities.push(currentLang === 'en' ? 'Profile suitable for leadership roles' : currentLang === 'pt' ? 'Perfil adequado para cargos de lideran√ßa' : 'Perfil apto para posiciones de direcci√≥n');
            
            swot.threats.push(currentLang === 'en' ? 'Increasing competition from specialized profiles' : currentLang === 'pt' ? 'Concorr√™ncia crescente de perfis especializados' : 'Competencia creciente de perfiles especializados');
            swot.threats.push(currentLang === 'en' ? 'Rapid technological changes require continuous learning' : currentLang === 'pt' ? 'Mudan√ßas tecnol√≥gicas r√°pidas exigem aprendizado cont√≠nuo' : 'Cambios tecnol√≥gicos r√°pidos exigen formaci√≥n continua');
            if (scores.technical < 70) swot.threats.push(currentLang === 'en' ? 'Risk of technical obsolescence' : currentLang === 'pt' ? 'Risco de obsolesc√™ncia t√©cnica' : 'Riesgo de obsolescencia t√©cnica');
            
            // RECOMENDACIONES CATEGORIZADAS v6.0
            const recommendations = {
                training: [],
                certification: [],
                cv_improvement: [],
                consultancy: []
            };
            
            // Training & Languages
            if (scores.languages < 80) {
                recommendations.training.push({
                    priority: 'high',
                    title: currentLang === 'en' ? 'Obtain C1 English certification' : currentLang === 'pt' ? 'Obter certifica√ß√£o C1 de ingl√™s' : 'Obtener certificaci√≥n C1 de ingl√©s',
                    description: currentLang === 'en' ? 'Many senior positions require certified C1 level. Consider Cambridge, IELTS or TOEFL' : currentLang === 'pt' ? 'Muitas posi√ß√µes seniores exigem n√≠vel C1 certificado. Considere Cambridge, IELTS ou TOEFL' : 'Muchas posiciones senior exigen nivel C1 certificado. Considera Cambridge, IELTS o TOEFL'
                });
            }
            if (scores.technical < 75) {
                recommendations.training.push({
                    priority: 'medium',
                    title: currentLang === 'en' ? 'Technical upskilling' : currentLang === 'pt' ? 'Capacita√ß√£o t√©cnica' : 'Formaci√≥n t√©cnica adicional',
                    description: currentLang === 'en' ? 'Consider courses in data analytics, Power BI, or sector-specific tools' : currentLang === 'pt' ? 'Considere cursos em an√°lise de dados, Power BI ou ferramentas espec√≠ficas do setor' : 'Considera cursos de an√°lisis de datos, Power BI o herramientas espec√≠ficas del sector'
                });
            }
            
            // Certifications
            if (!cvLower.includes('pmp') && !cvLower.includes('prince2')) {
                recommendations.certification.push({
                    priority: 'high',
                    title: currentLang === 'en' ? 'PMP or PRINCE2 certification' : currentLang === 'pt' ? 'Certifica√ß√£o PMP ou PRINCE2' : 'Certificaci√≥n PMP o PRINCE2',
                    description: currentLang === 'en' ? 'Essential for senior project management roles. PMP is globally recognized' : currentLang === 'pt' ? 'Essencial para cargos seniores de gest√£o de projetos. PMP √© reconhecido globalmente' : 'Esencial para roles senior de gesti√≥n de proyectos. PMP es reconocido globalmente'
                });
            }
            if (!cvLower.includes('lean') && !cvLower.includes('six sigma')) {
                recommendations.certification.push({
                    priority: 'medium',
                    title: currentLang === 'en' ? 'Lean Six Sigma Green Belt' : currentLang === 'pt' ? 'Lean Six Sigma Green Belt' : 'Lean Six Sigma Green Belt',
                    description: currentLang === 'en' ? 'Adds value for process optimization and transformation roles' : currentLang === 'pt' ? 'Agrega valor para cargos de otimiza√ß√£o e transforma√ß√£o' : 'Aporta valor para roles de optimizaci√≥n y transformaci√≥n de procesos'
                });
            }
            if (!cvLower.includes('safe') && !cvLower.includes('scrum')) {
                recommendations.certification.push({
                    priority: 'low',
                    title: currentLang === 'en' ? 'Agile/Scrum certification' : currentLang === 'pt' ? 'Certifica√ß√£o Agile/Scrum' : 'Certificaci√≥n Agile/Scrum',
                    description: currentLang === 'en' ? 'SAFe or Scrum Master certification demonstrates agile expertise' : currentLang === 'pt' ? 'Certifica√ß√£o SAFe ou Scrum Master demonstra expertise √°gil' : 'Certificaci√≥n SAFe o Scrum Master demuestra expertise √°gil'
                });
            }
            
            // CV Improvement
            recommendations.cv_improvement.push({
                priority: 'high',
                title: currentLang === 'en' ? 'Quantify all achievements' : currentLang === 'pt' ? 'Quantificar todas as conquistas' : 'Cuantificar todos los logros',
                description: currentLang === 'en' ? 'Add specific metrics: budgets (‚Ç¨), team sizes, % improvements, ROI' : currentLang === 'pt' ? 'Adicionar m√©tricas espec√≠ficas: or√ßamentos (‚Ç¨), tamanho de equipes, % de melhorias, ROI' : 'A√±adir m√©tricas espec√≠ficas: presupuestos (‚Ç¨), tama√±os de equipo, % de mejoras, ROI'
            });
            if (scores.soft < 70) {
                recommendations.cv_improvement.push({
                    priority: 'medium',
                    title: currentLang === 'en' ? 'Highlight soft skills with examples' : currentLang === 'pt' ? 'Destacar soft skills com exemplos' : 'Destacar soft skills con ejemplos',
                    description: currentLang === 'en' ? 'Include concrete examples of leadership, negotiation, conflict resolution' : currentLang === 'pt' ? 'Incluir exemplos concretos de lideran√ßa, negocia√ß√£o, resolu√ß√£o de conflitos' : 'Incluir ejemplos concretos de liderazgo, negociaci√≥n, resoluci√≥n de conflictos'
                });
            }
            recommendations.cv_improvement.push({
                priority: 'medium',
                title: currentLang === 'en' ? 'ATS optimization' : currentLang === 'pt' ? 'Otimiza√ß√£o ATS' : 'Optimizaci√≥n ATS',
                description: currentLang === 'en' ? 'Ensure your CV passes automated screening systems with proper formatting and keywords' : currentLang === 'pt' ? 'Garanta que seu CV passe pelos sistemas de triagem automatizados com formata√ß√£o e palavras-chave adequadas' : 'Asegura que tu CV pase los sistemas de filtrado autom√°tico con formato y keywords adecuados'
            });
            
            // Consultancy (always show)
            recommendations.consultancy.push({
                priority: 'high',
                title: currentLang === 'en' ? 'Personalized consulting session' : currentLang === 'pt' ? 'Sess√£o de consultoria personalizada' : 'Sesi√≥n de consultor√≠a personalizada',
                description: currentLang === 'en' ? 'Work 1:1 with RV Profile Studio experts to create a tailored action plan and optimize your professional positioning' : currentLang === 'pt' ? 'Trabalhe 1:1 com especialistas do RV Profile Studio para criar um plano de a√ß√£o personalizado e otimizar seu posicionamento profissional' : 'Trabaja 1:1 con expertos de RV Profile Studio para crear un plan de acci√≥n a medida y optimizar tu posicionamiento profesional'
            });
            
            // Synthesis generation
            const synthesis = generateSynthesis('Candidato/a', scores, swot, false);
            
            return {
                score: avgScore,
                competencies: scores,
                swot: swot,
                recommendations: recommendations,
                synthesis: synthesis,
                mode: 'rules'
            };
        }

        function generateSynthesis(name, scores, swot, isJobFit) {
            const avgScore = Math.round(Object.values(scores).reduce((a,b) => a+b, 0) / 6);
            const topAreas = Object.entries(scores).sort((a,b) => b[1] - a[1]).slice(0, 2);
            const weakAreas = Object.entries(scores).sort((a,b) => a[1] - b[1]).slice(0, 2);
            
            const areaNames = {
                es: { experience: 'experiencia', technical: 'competencias t√©cnicas', leadership: 'liderazgo', soft: 'soft skills', languages: 'idiomas', education: 'formaci√≥n' },
                en: { experience: 'experience', technical: 'technical skills', leadership: 'leadership', soft: 'soft skills', languages: 'languages', education: 'education' },
                pt: { experience: 'experi√™ncia', technical: 'compet√™ncias t√©cnicas', leadership: 'lideran√ßa', soft: 'soft skills', languages: 'idiomas', education: 'forma√ß√£o' }
            };
            
            const templates = {
                es: `Perfil s√≥lido con ${lastAnalysisScoring?.years || 'varios'} a√±os de experiencia progresiva en sector ${selectedSector === 'finance' ? 'financiero' : selectedSector === 'tech' ? 'tecnol√≥gico' : 'especializado'} y expertise t√©cnico muy ${scores.technical >= 70 ? 'destacado' : 'prometedor'} en ${topAreas[0] ? areaNames.es[topAreas[0][0]] : 'su √°rea'}. ${swot.weaknesses.length > 0 ? `Sin embargo, presenta ${swot.weaknesses.length > 2 ? 'algunas' : 'pocas'} √°reas de mejora: ${swot.weaknesses[0].toLowerCase()}.` : ''} ${avgScore >= 75 ? 'Perfil competitivo para posiciones senior.' : 'Con las mejoras indicadas, el perfil puede alcanzar mayor competitividad.'}`,
                en: `Solid profile with ${lastAnalysisScoring?.years || 'several'} years of progressive experience in the ${selectedSector === 'finance' ? 'financial' : selectedSector === 'tech' ? 'technology' : 'specialized'} sector and ${scores.technical >= 70 ? 'outstanding' : 'promising'} technical expertise in ${topAreas[0] ? areaNames.en[topAreas[0][0]] : 'their area'}. ${swot.weaknesses.length > 0 ? `However, there are ${swot.weaknesses.length > 2 ? 'some' : 'few'} areas for improvement: ${swot.weaknesses[0].toLowerCase()}.` : ''} ${avgScore >= 75 ? 'Competitive profile for senior positions.' : 'With the indicated improvements, the profile can achieve greater competitiveness.'}`,
                pt: `Perfil s√≥lido com ${lastAnalysisScoring?.years || 'v√°rios'} anos de experi√™ncia progressiva no setor ${selectedSector === 'finance' ? 'financeiro' : selectedSector === 'tech' ? 'tecnol√≥gico' : 'especializado'} e expertise t√©cnica muito ${scores.technical >= 70 ? 'destacada' : 'promissora'} em ${topAreas[0] ? areaNames.pt[topAreas[0][0]] : 'sua √°rea'}. ${swot.weaknesses.length > 0 ? `No entanto, apresenta ${swot.weaknesses.length > 2 ? 'algumas' : 'poucas'} √°reas de melhoria: ${swot.weaknesses[0].toLowerCase()}.` : ''} ${avgScore >= 75 ? 'Perfil competitivo para posi√ß√µes seniores.' : 'Com as melhorias indicadas, o perfil pode alcan√ßar maior competitividade.'}`
            };
            
            return templates[currentLang];
        }

        // ==================== ANALYSIS FUNCTIONS ====================
        async function analyzeProfile() {
            const cv = document.getElementById('cvInput').value;
            document.getElementById('loadingOverlay').classList.add('visible');
            
            try {
                let result;
                if (useAI) {
                    const apiKey = document.getElementById('apiKey').value;
                    result = await analyzeWithAI(cv, null, apiKey);
                } else {
                    result = analyzeWithRules(cv, null);
                }
                
                lastAnalysisResult = result;
                displayResults(result, false);
                document.getElementById('tab1').classList.add('completed');
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                document.getElementById('loadingOverlay').classList.remove('visible');
            }
        }

        async function analyzeJobFit() {
            const cv = document.getElementById('cvInput').value;
            const job = document.getElementById('jobInput').value;
            document.getElementById('loadingOverlay').classList.add('visible');
            
            try {
                let result;
                if (useAI) {
                    const apiKey = document.getElementById('apiKey').value;
                    result = await analyzeWithAI(cv, job, apiKey);
                } else {
                    result = analyzeWithRules(cv, job);
                }
                
                lastAnalysisResult = result;
                displayResults(result, true);
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                document.getElementById('loadingOverlay').classList.remove('visible');
            }
        }

        async function analyzeWithAI(cv, job, apiKey) {
            const sector = selectedSector || 'general';
            const level = selectedLevel || 'senior';
            
            let prompt = `Analyze this CV for a ${level} professional in ${sector} sector.
CV Content:
${cv}

${job ? `Job Description:\n${job}\n\nAnalyze CV-Job fit.` : 'Provide profile analysis.'}

CRITICAL: Always provide at least 3 realistic weaknesses. Be analytical and balanced.
Experience score should be primarily based on years of experience (not certifications).
Years of experience: check for patterns like "X a√±os" or "X years".

Language: ${currentLang === 'es' ? 'Spanish' : currentLang === 'pt' ? 'Portuguese' : 'English'}

Respond ONLY in valid JSON:
{"score":<0-100>,"competencies":{"experience":<0-100 based mainly on years>,"technical":<0-100>,"leadership":<0-100>,"soft":<0-100>,"languages":<0-100>,"education":<0-100>},"swot":{"strengths":[3 items],"weaknesses":[at least 3 real weaknesses],"opportunities":[2-3],"threats":[2-3]},"recommendations":{"training":[{"priority":"high|medium|low","title":"...","description":"..."}],"certification":[...],"cv_improvement":[...],"consultancy":[{"priority":"high","title":"Personalized consulting session","description":"Work 1:1 with RV Profile Studio experts"}]},"synthesis":"Executive summary paragraph"}`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey,
                    'anthropic-version': '2023-06-01',
                    'anthropic-dangerous-direct-browser-access': 'true'
                },
                body: JSON.stringify({
                    model: 'claude-sonnet-4-20250514',
                    max_tokens: 4000,
                    messages: [{ role: 'user', content: prompt }]
                })
            });

            if (!response.ok) throw new Error('API error: ' + response.status);
            const data = await response.json();
            const jsonMatch = data.content[0].text.match(/\{[\s\S]*\}/);
            if (!jsonMatch) throw new Error('Could not parse response');
            const result = JSON.parse(jsonMatch[0]);
            result.mode = 'ai';
            return result;
        }

        function displayResults(data, isJobFit) {
            document.getElementById('resultsSection').classList.add('visible');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            
            document.getElementById('mainScore').textContent = data.score + '%';
            document.getElementById('scoreLabel').textContent = translations[currentLang][isJobFit ? 'fit_score' : 'profile_score'];
            
            const scoreLevel = data.score >= 80 ? 'success' : data.score >= 60 ? 'warning' : 'danger';
            const scoreText = {
                success: { es: 'Excelente', en: 'Excellent', pt: 'Excelente' },
                warning: { es: 'Bueno', en: 'Good', pt: 'Bom' },
                danger: { es: 'A mejorar', en: 'Needs improvement', pt: 'A melhorar' }
            };
            
            document.getElementById('scoreMeta').innerHTML = `
                <div class="meta-item">
                    <span class="meta-dot ${scoreLevel}"></span>
                    <span>${scoreText[scoreLevel][currentLang]}</span>
                </div>
                <div class="meta-item">
                    <span style="color: var(--text-muted);">${data.mode === 'ai' ? 'üß† Claude AI' : '‚ö° Quick Analysis'}</span>
                </div>
            `;
            
            // Update score explanation
            updateScoringExplanation(data.competencies);
            
            if (data.synthesis) {
                document.getElementById('summaryContent').innerHTML = typeof data.synthesis === 'string' 
                    ? `<p>${data.synthesis}</p>` 
                    : data.synthesis;
            } else {
                document.getElementById('summaryContent').innerHTML = `<p>${generateSynthesis('Candidato/a', data.competencies, data.swot, isJobFit)}</p>`;
            }
            
            const labels = competencyLabels[currentLang];
            const compKeys = ['experience', 'technical', 'leadership', 'soft', 'languages', 'education'];
            
            document.getElementById('competencyBars').innerHTML = compKeys.map((key, i) => {
                const score = data.competencies[key];
                const level = score >= 80 ? 'excellent' : score >= 65 ? 'good' : score >= 50 ? 'moderate' : 'low';
                return `
                    <div class="comp-item">
                        <span class="comp-name">${labels[i]}</span>
                        <div class="comp-bar">
                            <div class="comp-fill ${level}" style="width: ${score}%"></div>
                        </div>
                        <span class="comp-score">${score}%</span>
                    </div>
                `;
            }).join('');
            
            updateRadar(data.competencies, labels);
            
            document.getElementById('strengths').innerHTML = data.swot.strengths.map(s => `<li>${s}</li>`).join('');
            document.getElementById('weaknesses').innerHTML = data.swot.weaknesses.map(s => `<li>${s}</li>`).join('');
            document.getElementById('opportunities').innerHTML = data.swot.opportunities.map(s => `<li>${s}</li>`).join('');
            document.getElementById('threats').innerHTML = data.swot.threats.map(s => `<li>${s}</li>`).join('');
            
            const keywordsCard = document.getElementById('keywordsCard');
            if (isJobFit && data.keywords) {
                keywordsCard.style.display = 'block';
                document.getElementById('goldenKeywords').innerHTML = data.keywords.golden.map(k => `<span class="keyword-tag golden">${k}</span>`).join('');
                document.getElementById('foundKeywords').innerHTML = data.keywords.found.map(k => `<span class="keyword-tag found">${k}</span>`).join('');
                document.getElementById('missingKeywords').innerHTML = data.keywords.missing.map(k => `<span class="keyword-tag missing">${k}</span>`).join('');
            } else {
                keywordsCard.style.display = 'none';
            }
            
            // Display categorized recommendations
            displayCategorizedRecommendations(data.recommendations);
            
            document.getElementById('continueToPhase2').style.display = isJobFit ? 'none' : 'flex';
        }

        function updateScoringExplanation(competencies) {
            const t = translations[currentLang];
            const factors = [
                { icon: 'üíº', key: 'experience', title: t.scoring_experience, desc: t.scoring_experience_desc, score: competencies.experience },
                { icon: 'üîß', key: 'technical', title: t.scoring_technical, desc: t.scoring_technical_desc, score: competencies.technical },
                { icon: 'üéì', key: 'education', title: t.scoring_education, desc: t.scoring_education_desc, score: competencies.education },
                { icon: 'üåç', key: 'languages', title: t.scoring_languages, desc: t.scoring_languages_desc, score: competencies.languages },
                { icon: 'üë•', key: 'leadership', title: t.scoring_leadership, desc: t.scoring_leadership_desc, score: competencies.leadership },
                { icon: 'ü§ù', key: 'soft', title: t.scoring_soft, desc: t.scoring_soft_desc, score: competencies.soft }
            ];
            
            document.getElementById('scoringFactors').innerHTML = factors.map(f => `
                <div class="scoring-factor">
                    <div class="scoring-factor-icon">${f.icon}</div>
                    <div class="scoring-factor-text">
                        <h5>${f.title}: ${f.score}%</h5>
                        <p>${f.desc}</p>
                    </div>
                </div>
            `).join('');
        }

        function displayCategorizedRecommendations(recommendations) {
            const t = translations[currentLang];
            const categories = [
                { key: 'training', icon: 'üìö', title: t.rec_training, class: 'training' },
                { key: 'certification', icon: 'üèÖ', title: t.rec_certification, class: 'certification' },
                { key: 'cv_improvement', icon: 'üìù', title: t.rec_cv_improvement, class: 'cv-improvement' }
            ];
            
            let html = '';
            
            categories.forEach(cat => {
                const items = recommendations[cat.key] || [];
                if (items.length > 0) {
                    html += `
                        <div class="rec-category">
                            <div class="rec-category-header ${cat.class}">
                                <div class="rec-category-icon">${cat.icon}</div>
                                <span class="rec-category-title">${cat.title}</span>
                            </div>
                            ${items.map(r => `
                                <div class="recommendation-item">
                                    <div class="rec-priority ${r.priority}"></div>
                                    <div class="rec-content">
                                        <h4>${r.title}</h4>
                                        <p>${r.description}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            });
            
            document.getElementById('recommendations').innerHTML = html;
        }

        function updateRadar(competencies, labels) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if (radarChart) radarChart.destroy();
            
            const compKeys = ['experience', 'technical', 'leadership', 'soft', 'languages', 'education'];
            
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Profile',
                        data: compKeys.map(k => competencies[k]),
                        fill: true,
                        backgroundColor: 'rgba(184, 134, 11, 0.15)',
                        borderColor: '#b8860b',
                        pointBackgroundColor: '#b8860b',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(0,0,0,0.1)' },
                            grid: { color: 'rgba(0,0,0,0.1)' },
                            pointLabels: { 
                                color: currentTheme === 'dark' ? '#a8a29e' : '#57534e',
                                font: { size: 11, family: 'Source Sans 3' }
                            },
                            ticks: { display: false },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // ==================== PDF DOWNLOAD v6.0 ====================
        function downloadPDFReport() {
            if (!lastAnalysisResult) {
                alert('No hay an√°lisis para descargar');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const data = lastAnalysisResult;
            const date = new Date().toLocaleDateString(currentLang === 'en' ? 'en-US' : currentLang === 'pt' ? 'pt-BR' : 'es-ES');
            
            // Colors
            const gold = [184, 134, 11];
            const darkGray = [28, 25, 23];
            const mediumGray = [87, 83, 78];
            const lightGray = [231, 229, 228];
            
            // Header
            doc.setFillColor(...gold);
            doc.rect(0, 0, 210, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(24);
            doc.setFont('helvetica', 'bold');
            doc.text('RV PROFILE STUDIO', 20, 20);
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('Professional CV Analysis Report', 20, 30);
            
            doc.setFontSize(10);
            doc.text(`Generated: ${date}`, 150, 30);
            
            // Score Section
            let y = 55;
            
            doc.setFillColor(...lightGray);
            doc.roundedRect(15, y - 5, 180, 35, 3, 3, 'F');
            
            doc.setTextColor(...gold);
            doc.setFontSize(48);
            doc.setFont('helvetica', 'bold');
            doc.text(`${data.score}%`, 105, y + 18, { align: 'center' });
            
            doc.setTextColor(...mediumGray);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(translations[currentLang].profile_score, 105, y + 28, { align: 'center' });
            
            y += 45;
            
            // Executive Summary
            doc.setTextColor(...darkGray);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text(translations[currentLang].executive_summary.replace('üìã ', ''), 20, y);
            
            y += 8;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...mediumGray);
            
            const summaryText = document.getElementById('summaryContent').innerText;
            const splitSummary = doc.splitTextToSize(summaryText, 170);
            doc.text(splitSummary, 20, y);
            y += splitSummary.length * 5 + 10;
            
            // Competencies
            doc.setTextColor(...darkGray);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text(translations[currentLang].competencies_title, 20, y);
            
            y += 10;
            const labels = competencyLabels[currentLang];
            const compKeys = ['experience', 'technical', 'leadership', 'soft', 'languages', 'education'];
            
            compKeys.forEach((key, i) => {
                const score = data.competencies[key];
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...mediumGray);
                doc.text(labels[i], 20, y);
                
                // Bar background
                doc.setFillColor(...lightGray);
                doc.rect(70, y - 4, 100, 6, 'F');
                
                // Bar fill
                const barColor = score >= 80 ? [5, 150, 105] : score >= 65 ? gold : score >= 50 ? [217, 119, 6] : [220, 38, 38];
                doc.setFillColor(...barColor);
                doc.rect(70, y - 4, score, 6, 'F');
                
                doc.setTextColor(...darkGray);
                doc.setFont('helvetica', 'bold');
                doc.text(`${score}%`, 175, y);
                
                y += 10;
            });
            
            y += 5;
            
            // SWOT
            if (y > 200) {
                doc.addPage();
                y = 20;
            }
            
            doc.setTextColor(...darkGray);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text(translations[currentLang].swot_title, 20, y);
            
            y += 10;
            
            const swotSections = [
                { title: translations[currentLang].strengths, items: data.swot.strengths, color: [5, 150, 105] },
                { title: translations[currentLang].weaknesses, items: data.swot.weaknesses, color: [220, 38, 38] },
                { title: translations[currentLang].opportunities, items: data.swot.opportunities, color: gold },
                { title: translations[currentLang].threats, items: data.swot.threats, color: mediumGray }
            ];
            
            swotSections.forEach(section => {
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                
                doc.setFillColor(...section.color);
                doc.rect(20, y - 3, 3, 8, 'F');
                
                doc.setTextColor(...section.color);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(section.title, 26, y + 2);
                
                y += 8;
                
                doc.setTextColor(...mediumGray);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                
                section.items.forEach(item => {
                    const splitItem = doc.splitTextToSize(`‚Ä¢ ${item}`, 160);
                    doc.text(splitItem, 26, y);
                    y += splitItem.length * 4 + 2;
                });
                
                y += 5;
            });
            
            // Recommendations
            if (y > 200) {
                doc.addPage();
                y = 20;
            }
            
            doc.setTextColor(...darkGray);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text(translations[currentLang].recommendations_title, 20, y);
            
            y += 10;
            
            const allRecs = [
                ...(data.recommendations.training || []),
                ...(data.recommendations.certification || []),
                ...(data.recommendations.cv_improvement || [])
            ];
            
            allRecs.forEach(rec => {
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                
                const priorityColor = rec.priority === 'critical' || rec.priority === 'high' ? [220, 38, 38] : rec.priority === 'medium' ? gold : [5, 150, 105];
                doc.setFillColor(...priorityColor);
                doc.rect(20, y - 3, 3, 12, 'F');
                
                doc.setTextColor(...darkGray);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text(rec.title, 26, y + 2);
                
                doc.setTextColor(...mediumGray);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                const splitDesc = doc.splitTextToSize(rec.description, 155);
                doc.text(splitDesc, 26, y + 8);
                
                y += 10 + splitDesc.length * 4 + 5;
            });
            
            // Footer with CTA
            if (y > 240) {
                doc.addPage();
                y = 20;
            }
            
            doc.setFillColor(...gold);
            doc.roundedRect(15, y + 5, 180, 30, 3, 3, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text(translations[currentLang].consultancy_title.replace('¬ø', '').replace('?', ''), 105, y + 17, { align: 'center' });
            
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text('Contact: rvprofilestudio@gmail.com', 105, y + 27, { align: 'center' });
            
            // Final footer
            doc.setTextColor(...mediumGray);
            doc.setFontSize(8);
            doc.text('RV Profile Studio v6.0 | ¬© 2025', 105, 290, { align: 'center' });
            
            // Save
            doc.save(`RV_Profile_Report_${date.replace(/\//g, '-')}.pdf`);
        }

        function requestConsultancy() {
            const subject = encodeURIComponent('Solicitud de Consultor√≠a - RV Profile Studio');
            const body = encodeURIComponent(`Hola,

Me gustar√≠a solicitar una sesi√≥n de consultor√≠a personalizada tras analizar mi perfil en RV Profile Studio.

Mi puntuaci√≥n: ${lastAnalysisResult?.score || 'N/A'}%

Quedo a la espera de m√°s informaci√≥n sobre disponibilidad y tarifas.

Saludos`);
            
            window.open(`mailto:rvprofilestudio@gmail.com?subject=${subject}&body=${body}`, '_blank');
        }

        checkReady();
    </script>
</body>
</html>
