<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RV Profile Studio | Consultor√≠a de Carrera & An√°lisis IA</title>
    <meta name="description" content="An√°lisis profesional de CV y ajuste de perfil con IA y algoritmos heur√≠sticos.">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- SISTEMA DE DISE√ëO (Design System) --- */
        :root {
            --bg-body: #fdfbf7; /* Blanco roto c√°lido */
            --bg-card: #ffffff;
            --bg-sidebar: #1a1a1a;
            
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --text-inv: #f3f4f6;

            --brand-primary: #b48e43; /* Dorado Premium */
            --brand-secondary: #8c6b2d;
            --brand-accent: #111827; /* Negro casi puro */

            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;

            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Inter', sans-serif;

            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --radius: 12px;
        }

        /* Modo Oscuro (Autom√°tico o Manual) */
        [data-theme="dark"] {
            --bg-body: #111111;
            --bg-card: #1e1e1e;
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --brand-accent: #ffffff;
            --shadow-card: 0 4px 20px rgba(0,0,0,0.4);
        }

        /* --- ESTILOS GENERALES --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-sans);
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        h1, h2, h3, h4 { font-family: var(--font-serif); color: var(--text-main); }
        
        /* Layout */
        .app-container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 30px 0; border-bottom: 1px solid rgba(0,0,0,0.1); margin-bottom: 40px;
        }
        .logo { font-size: 1.8rem; font-weight: 700; color: var(--brand-primary); letter-spacing: -0.5px; }
        .logo span { color: var(--text-main); }
        
        .controls { display: flex; gap: 15px; align-items: center; }
        .btn-icon { background: none; border: 1px solid var(--text-muted); color: var(--text-main); padding: 8px; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .btn-icon:hover { border-color: var(--brand-primary); color: var(--brand-primary); }

        /* Steps */
        .stepper { display: flex; justify-content: center; gap: 40px; margin-bottom: 40px; }
        .step { display: flex; align-items: center; gap: 10px; opacity: 0.5; cursor: pointer; transition: 0.3s; }
        .step.active { opacity: 1; font-weight: 600; color: var(--brand-primary); }
        .step-num { width: 30px; height: 30px; border-radius: 50%; border: 2px solid currentColor; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }

        /* Panels */
        .panel { display: none; animation: fadeIn 0.5s ease; }
        .panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards & Inputs */
        .card { background: var(--bg-card); padding: 30px; border-radius: var(--radius); box-shadow: var(--shadow-card); margin-bottom: 25px; border: 1px solid rgba(0,0,0,0.05); }
        .card-title { margin-bottom: 20px; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; }
        
        label { display: block; margin-bottom: 8px; font-weight: 500; font-size: 0.9rem; }
        textarea, input, select {
            width: 100%; padding: 12px; border: 1px solid var(--text-muted); border-radius: 8px;
            background: var(--bg-body); color: var(--text-main); font-family: var(--font-sans); font-size: 1rem;
            transition: 0.2s;
        }
        textarea:focus, input:focus, select:focus { outline: none; border-color: var(--brand-primary); ring: 2px solid rgba(180, 142, 67, 0.2); }
        textarea { min-height: 200px; resize: vertical; }

        /* Botones */
        .btn-primary {
            background: var(--brand-primary); color: white; border: none; padding: 14px 28px;
            border-radius: 8px; font-weight: 600; font-size: 1rem; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s; width: 100%; display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(180, 142, 67, 0.3); background: var(--brand-secondary); }
        .btn-primary:disabled { background: var(--text-muted); cursor: not-allowed; transform: none; box-shadow: none; }
        
        .btn-secondary {
            background: transparent; border: 2px solid var(--brand-primary); color: var(--brand-primary);
            padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .btn-secondary:hover { background: rgba(180, 142, 67, 0.1); }

        /* Selectors (Pills) */
        .grid-options { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .option-pill {
            padding: 12px; border: 1px solid var(--text-muted); border-radius: 8px;
            text-align: center; cursor: pointer; font-size: 0.9rem; transition: 0.2s;
        }
        .option-pill:hover { border-color: var(--brand-primary); color: var(--brand-primary); }
        .option-pill.active { background: var(--brand-primary); color: white; border-color: var(--brand-primary); }

        /* Results Section */
        .score-display { text-align: center; padding: 40px 0; }
        .big-score { font-size: 5rem; font-weight: 700; color: var(--brand-primary); line-height: 1; font-family: var(--font-serif); }
        .score-label { font-size: 1.2rem; color: var(--text-muted); margin-bottom: 20px; }

        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 30px; }
        @media (max-width: 768px) { .dashboard-grid { grid-template-columns: 1fr; } }

        .metric-bar { display: flex; align-items: center; margin-bottom: 12px; gap: 10px; }
        .metric-name { width: 100px; font-size: 0.9rem; font-weight: 500; }
        .bar-container { flex-grow: 1; height: 8px; background: rgba(0,0,0,0.1); border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; border-radius: 4px; transition: width 1s ease; }
        .bar-val { width: 40px; text-align: right; font-size: 0.85rem; font-weight: 600; }

        .list-check li { list-style: none; padding-left: 25px; position: relative; margin-bottom: 8px; font-size: 0.95rem; }
        .list-check li::before { content: '‚úì'; position: absolute; left: 0; color: var(--success); font-weight: bold; }
        .list-warn li::before { content: '‚ö†'; color: var(--warning); }
        .list-danger li::before { content: '‚úï'; color: var(--danger); }

        /* API Toggle */
        .api-mode { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--text-muted); font-size: 0.9rem; }
        .api-details { display: none; margin-top: 10px; background: rgba(0,0,0,0.03); padding: 15px; border-radius: 8px; }
        .api-details.visible { display: block; }
        .toggle-label { display: flex; align-items: center; gap: 10px; cursor: pointer; }

        /* Loading */
        .loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); z-index: 1000;
            display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        .spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid var(--brand-primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="loader" id="loader">
    <div class="spinner"></div>
    <p style="margin-top: 20px; font-weight: 500;" id="loaderText">Analizando perfil profesional...</p>
</div>

<div class="app-container">
    <header>
        <div class="logo">RV <span>Profile Studio</span></div>
        <div class="controls">
            <select id="langSelect" onchange="changeLang(this.value)" style="width: auto; padding: 6px 12px;">
                <option value="es">ES</option>
                <option value="en">EN</option>
                <option value="pt">PT</option>
            </select>
            <button class="btn-icon" onclick="toggleTheme()">üåó</button>
        </div>
    </header>

    <div class="stepper">
        <div class="step active" onclick="showPanel(1)" id="step1">
            <div class="step-num">1</div>
            <span>An√°lisis</span>
        </div>
        <div class="step" onclick="showPanel(2)" id="step2">
            <div class="step-num">2</div>
            <span>Job Fit</span>
        </div>
        <div class="step" onclick="showPanel(3)" id="step3">
            <div class="step-num">3</div>
            <span>Resultados</span>
        </div>
    </div>

    <div class="panel active" id="panel1">
        <div class="card">
            <div class="card-title">üéØ Sector Profesional</div>
            <div class="grid-options" id="sectorGrid">
                </div>
            
            <div class="card-title" style="margin-top: 30px;">üìä Nivel de Experiencia</div>
            <div class="grid-options" id="levelGrid">
                <div class="option-pill" onclick="selectLevel('junior', this)">Junior (0-3)</div>
                <div class="option-pill" onclick="selectLevel('mid', this)">Mid-Level (3-7)</div>
                <div class="option-pill" onclick="selectLevel('senior', this)">Senior (7+)</div>
                <div class="option-pill" onclick="selectLevel('exec', this)">Executive</div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">üìÑ Tu Curr√≠culum (Texto)</div>
            <textarea id="cvInput" placeholder="Pega aqu√≠ el contenido de tu CV..."></textarea>
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <button class="btn-secondary" onclick="loadExample()" style="font-size: 0.8rem; padding: 8px 16px;">Cargar Ejemplo</button>
                <small id="charCount" style="color: var(--text-muted)">0 caracteres</small>
            </div>
        </div>

        <div class="card">
            <div class="api-mode">
                <label class="toggle-label">
                    <input type="checkbox" id="aiToggle" onchange="toggleAI(this)"> 
                    <span>Habilitar An√°lisis Profundo con IA (Opcional - Requiere API Key)</span>
                </label>
                <div class="api-details" id="apiDetails">
                    <p style="font-size: 0.85rem; margin-bottom: 10px; color: var(--text-muted);">
                        ‚ÑπÔ∏è <strong>Para Consultores:</strong> Usa tu propia API Key de Anthropic/Claude para generar un reporte premium. Los datos se env√≠an directamente a Anthropic, no se guardan en ning√∫n servidor intermedio.
                    </p>
                    <input type="password" id="apiKey" placeholder="sk-ant-api03-..." autocomplete="off">
                </div>
            </div>
        </div>

        <button class="btn-primary" onclick="runPhase1()">Analizar Perfil</button>
    </div>

    <div class="panel" id="panel2">
        <div class="card">
            <h3 class="card-title">üíº Descripci√≥n del Puesto</h3>
            <p style="margin-bottom: 15px; color: var(--text-muted);">Pega la descripci√≥n de la oferta de trabajo para calcular la compatibilidad.</p>
            <textarea id="jobInput" placeholder="Requisitos del puesto, responsabilidades..."></textarea>
        </div>
        <div style="display: flex; gap: 15px;">
            <button class="btn-secondary" onclick="showPanel(1)">Atr√°s</button>
            <button class="btn-primary" onclick="runPhase2()">Calcular Compatibilidad</button>
        </div>
    </div>

    <div class="panel" id="panel3">
        <div class="score-display">
            <div class="big-score" id="finalScore">0%</div>
            <div class="score-label" id="scoreLabelText">Puntuaci√≥n de Perfil</div>
            <button class="btn-secondary" onclick="generatePDF()">üì• Descargar Informe PDF</button>
        </div>

        <div class="dashboard-grid">
            <div>
                <div class="card">
                    <div class="card-title">Competencias</div>
                    <canvas id="radarChart"></canvas>
                    <div id="metricsList" style="margin-top: 20px;"></div>
                </div>
                
                <div class="card">
                    <div class="card-title">S√≠ntesis Ejecutiva</div>
                    <p id="synthesisText" style="font-size: 0.95rem; color: var(--text-muted);">Esperando an√°lisis...</p>
                </div>
            </div>

            <div>
                <div class="card">
                    <div class="card-title" style="color: var(--success);">Fortalezas</div>
                    <ul class="list-check" id="strengthsList"></ul>
                </div>
                
                <div class="card">
                    <div class="card-title" style="color: var(--warning);">√Åreas de Mejora</div>
                    <ul class="list-warn" id="weaknessesList"></ul>
                </div>

                <div class="card" id="recommendationsCard">
                    <div class="card-title">Plan de Acci√≥n</div>
                    <div id="recContainer"></div>
                </div>
                
                <div class="card" style="background: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-secondary) 100%); color: white;">
                    <div class="card-title" style="color: white;">¬øNecesitas ayuda experta?</div>
                    <p style="font-size: 0.9rem; margin-bottom: 15px;">Solicita una sesi√≥n estrat√©gica de 1 hora para revisar estos resultados.</p>
                    <button style="width: 100%; background: white; color: var(--brand-primary); border: none; padding: 10px; border-radius: 6px; font-weight: bold; cursor: pointer;" onclick="contactEmail()">Contactar Consultor</button>
                </div>
            </div>
        </div>
        <button class="btn-secondary" onclick="location.reload()" style="margin-top: 30px; width: 100%;">Nuevo An√°lisis</button>
    </div>
</div>

<script>
    // --- ESTADO & CONFIGURACI√ìN ---
    let state = {
        lang: 'es',
        sector: null,
        level: null,
        cv: '',
        job: '',
        apiKey: '',
        results: null
    };

    // Diccionario de Traducci√≥n Simple
    const i18n = {
        es: { analyze: "Analizando...", score_profile: "Calidad del Perfil", score_fit: "Ajuste al Puesto", report: "Informe Profesional" },
        en: { analyze: "Analyzing...", score_profile: "Profile Quality", score_fit: "Job Fit Score", report: "Professional Report" },
        pt: { analyze: "Analisando...", score_profile: "Qualidade do Perfil", score_fit: "Ader√™ncia √† Vaga", report: "Relat√≥rio Profissional" }
    };

    // Palabras Clave por Sector (Expandido)
    const sectors = {
        tech: { label: "Tecnolog√≠a", kws: ["javascript", "python", "java", "react", "aws", "azure", "docker", "kubernetes", "sql", "nosql", "git", "scrum", "agile", "ci/cd", "devops", "api", "rest", "microservices", "testing", "cloud", "security"] },
        finance: { label: "Finanzas", kws: ["forecast", "budget", "audit", "compliance", "riesgo", "risk", "ifrs", "gaap", "sap", "excel", "bloomberg", "trading", "aml", "kyc", "reporting", "tax", "treasury", "valuation", "m&a", "portfolio"] },
        marketing: { label: "Marketing", kws: ["seo", "sem", "analytics", "google ads", "social media", "crm", "hubspot", "salesforce", "content", "branding", "kpi", "roi", "leads", "funnel", "email marketing", "growth", "copywriting", "pr"] },
        sales: { label: "Ventas / BizDev", kws: ["prospecci√≥n", "negociaci√≥n", "crm", "salesforce", "pipeline", "closing", "b2b", "b2c", "account management", "cold calling", "revenue", "quota", "forecast", "relationship", "strategy"] },
        ops: { label: "Operaciones / PM", kws: ["project management", "pmp", "agile", "kanban", "jira", "operations", "logistics", "supply chain", "process", "improvement", "lean", "six sigma", "kpi", "stakeholder", "budget", "planning", "risk"] },
        hr: { label: "RRHH", kws: ["recruiting", "talent", "onboarding", "culture", "training", "payroll", "labor", "law", "engagement", "performance", "coaching", "sourcing", "linkedin", "diversity", "benefits"] }
    };

    // --- L√ìGICA DE UI ---
    function init() {
        const sectorContainer = document.getElementById('sectorGrid');
        Object.keys(sectors).forEach(key => {
            sectorContainer.innerHTML += `<div class="option-pill" onclick="selectSector('${key}', this)">${sectors[key].label}</div>`;
        });
        document.getElementById('cvInput').addEventListener('input', (e) => {
            document.getElementById('charCount').textContent = `${e.target.value.length} caracteres`;
        });
    }

    function changeLang(l) { state.lang = l; }
    
    function toggleTheme() {
        document.body.dataset.theme = document.body.dataset.theme === 'dark' ? '' : 'dark';
    }

    function selectSector(s, el) {
        state.sector = s;
        document.querySelectorAll('#sectorGrid .option-pill').forEach(e => e.classList.remove('active'));
        el.classList.add('active');
    }

    function selectLevel(l, el) {
        state.level = l;
        document.querySelectorAll('#levelGrid .option-pill').forEach(e => e.classList.remove('active'));
        el.classList.add('active');
    }

    function toggleAI(checkbox) {
        document.getElementById('apiDetails').classList.toggle('visible', checkbox.checked);
    }

    function showPanel(n) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.getElementById(`panel${n}`).classList.add('active');
        document.querySelectorAll('.step').forEach((s, i) => {
            s.classList.toggle('active', i + 1 === n);
        });
    }

    function loadExample() {
        document.getElementById('cvInput').value = "EXPERIENCIA PROFESIONAL\n\nSenior Project Manager | Tech Solutions | 2018 - Presente\n- Lider√© equipos √°giles de 15 personas usando Scrum y JIRA.\n- Aument√© la eficiencia operativa en un 20% implementando procesos CI/CD.\n- Gestion√© presupuesto de 500k USD anuales.\n\nEDUCACI√ìN\nM√°ster en Administraci√≥n de Empresas (MBA) - IE Business School\nIngenier√≠a Inform√°tica - Universidad Polit√©cnica\n\nSKILLS\nJavascript, React, Node.js, AWS, Liderazgo, Negociaci√≥n, Ingl√©s C1.";
        document.getElementById('charCount').textContent = `${document.getElementById('cvInput').value.length} caracteres`;
    }

    // --- MOTOR DE AN√ÅLISIS (CORE) ---
    async function runPhase1() {
        state.cv = document.getElementById('cvInput').value;
        state.apiKey = document.getElementById('apiKey').value;
        
        if (!state.sector || !state.level || state.cv.length < 50) {
            alert("Por favor selecciona sector, nivel y a√±ade un CV v√°lido.");
            return;
        }

        showLoader(true);

        try {
            if (document.getElementById('aiToggle').checked && state.apiKey) {
                // Modo AI
                state.results = await analyzeWithAI(state.cv, null);
            } else {
                // Modo Algoritmo Local (Coste Cero)
                await simulateDelay(); // Efecto psicol√≥gico
                state.results = analyzeLocally(state.cv, null);
            }
            
            renderResults(state.results, false);
            showPanel(3);
        } catch (e) {
            alert("Error: " + e.message);
        } finally {
            showLoader(false);
        }
    }

    async function runPhase2() {
        state.job = document.getElementById('jobInput').value;
        if (state.job.length < 50) { alert("A√±ade una descripci√≥n de puesto v√°lida."); return; }
        
        showLoader(true);
        try {
            if (document.getElementById('aiToggle').checked && state.apiKey) {
                state.results = await analyzeWithAI(state.cv, state.job);
            } else {
                await simulateDelay();
                state.results = analyzeLocally(state.cv, state.job);
            }
            renderResults(state.results, true);
            showPanel(3);
        } catch (e) {
            alert("Error: " + e.message);
        } finally {
            showLoader(false);
        }
    }

    function analyzeLocally(cv, job) {
        const text = (cv + " " + (job || "")).toLowerCase();
        const sectorKws = sectors[state.sector].kws;
        
        // 1. Detecci√≥n de Keywords
        const foundKws = sectorKws.filter(k => text.includes(k));
        const techScore = Math.min(100, Math.round((foundKws.length / (job ? sectorKws.length * 0.5 : 5)) * 100)); // Ajuste din√°mico

        // 2. Experiencia (Heur√≠stica simple)
        const years = (text.match(/(\d+)\s+(a√±os|years|anos)/g) || []).map(s => parseInt(s)).reduce((a,b) => Math.max(a,b), 0) || 3;
        const expScore = Math.min(100, years * 12);

        // 3. Soft Skills (Diccionario base)
        const softKws = ["liderazgo", "comunicaci√≥n", "equipo", "proactivo", "an√°lisis", "gesti√≥n", "leadership", "communication", "team", "management"];
        const softFound = softKws.filter(k => text.includes(k));
        const softScore = Math.min(100, softFound.length * 15 + 40);

        // 4. Idiomas
        const langScore = /c1|c2|biling|native|nativo|fluent/i.test(text) ? 95 : /b2|intermedio/i.test(text) ? 70 : 40;

        // 5. C√°lculo Final
        const scores = { 
            T√©cnico: techScore, 
            Experiencia: expScore, 
            Soft: softScore, 
            Idiomas: langScore, 
            Formaci√≥n: text.includes("m√°ster") || text.includes("master") || text.includes("mba") ? 90 : 70 
        };
        
        let total = Object.values(scores).reduce((a,b)=>a+b,0) / 5;
        if (job) {
            // Penalizaci√≥n si faltan keywords del job description
            const jobWords = job.toLowerCase().split(/\s+/).filter(w => w.length > 5);
            const matches = jobWords.filter(w => cv.toLowerCase().includes(w));
            const fit = (matches.length / jobWords.length) * 100;
            total = (total * 0.6) + (fit * 0.4);
        }

        return {
            score: Math.round(total),
            breakdown: scores,
            strengths: [`${foundKws.length} palabras clave t√©cnicas detectadas`, years > 5 ? "S√≥lida trayectoria temporal detectada" : "Perfil junior con potencial", langScore > 80 ? "Nivel de idiomas competitivo" : "Formaci√≥n base correcta"],
            weaknesses: [foundKws.length < 3 ? "Baja densidad de palabras clave del sector" : null, langScore < 60 ? "No se detecta certificaci√≥n de idioma alto (C1/C2)" : null, "Cuantificaci√≥n de logros (KPIs num√©ricos) mejorable"].filter(Boolean),
            recs: ["A√±ade m√©tricas num√©ricas (%, $) a tus logros.", "Incluye certificaciones espec√≠ficas de tu sector.", "Optimiza el resumen ejecutivo al inicio del CV."]
        };
    }

    async function analyzeWithAI(cv, job) {
        // Llamada a Anthropic (Solo si el usuario puso su KEY)
        const prompt = `Actua como experto en RRHH. Analiza este CV para sector ${state.sector}. ${job ? "Comparalo con esta oferta: "+job : ""}. 
        Responde SOLO JSON: {"score": 0-100, "breakdown": {"T√©cnico":0, "Experiencia":0, "Soft":0, "Idiomas":0, "Formaci√≥n":0}, "strengths":["str1","str2"], "weaknesses":["wk1","wk2"], "recs":["rec1","rec2"], "synthesis": "Resumen ejecutivo de 50 palabras."}`;
        
        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: { 'x-api-key': state.apiKey, 'anthropic-version': '2023-06-01', 'content-type': 'application/json', 'anthropic-dangerous-direct-browser-access': 'true' },
            body: JSON.stringify({ model: 'claude-3-haiku-20240307', max_tokens: 1000, messages: [{ role: 'user', content: prompt + "\nCV: " + cv }] })
        });
        const data = await response.json();
        return JSON.parse(data.content[0].text);
    }

    // --- RENDERIZADO Y UTILIDADES ---
    let chartInstance = null;

    function renderResults(data, isJob) {
        document.getElementById('finalScore').textContent = `${data.score}%`;
        document.getElementById('scoreLabelText').textContent = isJob ? i18n[state.lang].score_fit : i18n[state.lang].score_profile;
        document.getElementById('synthesisText').textContent = data.synthesis || "El perfil muestra una alineaci√≥n moderada con los est√°ndares del sector. Se recomienda enfocar el CV en logros cuantificables y palabras clave t√©cnicas espec√≠ficas.";

        // Listas
        const fillList = (id, arr) => document.getElementById(id).innerHTML = arr.map(i => `<li>${i}</li>`).join('');
        fillList('strengthsList', data.strengths);
        fillList('weaknessesList', data.weaknesses);
        
        document.getElementById('recContainer').innerHTML = data.recs.map(r => `<div style="background:rgba(0,0,0,0.02); padding:10px; border-left:3px solid var(--brand-primary); margin-bottom:8px; font-size:0.9rem;">${r}</div>`).join('');

        // Chart
        const ctx = document.getElementById('radarChart').getContext('2d');
        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: Object.keys(data.breakdown),
                datasets: [{
                    label: 'Perfil',
                    data: Object.values(data.breakdown),
                    backgroundColor: 'rgba(180, 142, 67, 0.2)',
                    borderColor: '#b48e43',
                    pointBackgroundColor: '#b48e43'
                }]
            },
            options: { scales: { r: { suggestedMin: 0, suggestedMax: 100 } } }
        });

        // M√©tricas Lineales
        document.getElementById('metricsList').innerHTML = Object.entries(data.breakdown).map(([k, v]) => `
            <div class="metric-bar">
                <div class="metric-name">${k}</div>
                <div class="bar-container"><div class="bar-fill" style="width: ${v}%; background: ${v>75?'var(--success)':v>50?'var(--warning)':'var(--danger)'}"></div></div>
                <div class="bar-val">${v}%</div>
            </div>
        `).join('');
    }

    function generatePDF() {
        if (!state.results) return;
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Cabecera
        doc.setFillColor(180, 142, 67);
        doc.rect(0, 0, 210, 20, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(16);
        doc.text("RV Profile Studio - Informe Profesional", 10, 13);
        
        // Contenido
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(12);
        doc.text(`Fecha: ${new Date().toLocaleDateString()} | Puntuaci√≥n: ${state.results.score}%`, 10, 35);
        
        doc.setFontSize(14);
        doc.text("S√≠ntesis", 10, 50);
        doc.setFontSize(10);
        const splitText = doc.splitTextToSize(document.getElementById('synthesisText').textContent, 180);
        doc.text(splitText, 10, 60);
        
        doc.setFontSize(14);
        doc.text("Fortalezas y √Åreas de Mejora", 10, 90);
        doc.setFontSize(10);
        
        let y = 100;
        state.results.strengths.forEach(s => { doc.text(`+ ${s}`, 10, y); y += 7; });
        y += 5;
        state.results.weaknesses.forEach(w => { doc.text(`- ${w}`, 10, y); y += 7; });
        
        doc.save("RV_Profile_Report.pdf");
    }

    function showLoader(show) {
        document.getElementById('loader').style.display = show ? 'flex' : 'none';
        document.getElementById('loaderText').textContent = i18n[state.lang].analyze;
    }

    function simulateDelay() { return new Promise(resolve => setTimeout(resolve, 1500)); }
    function contactEmail() { window.location.href = "mailto:tuemail@ejemplo.com?subject=Solicitud Consultor√≠a"; }

    // Init
    init();
</script>
</body>
</html>
