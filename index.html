<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RV Profile Studio | An√°lisis Profesional de CV</title>
    <meta name="description" content="Analiza tu CV con inteligencia artificial. Obt√©n tu puntuaci√≥n, an√°lisis DAFO y recomendaciones personalizadas para destacar en el mercado laboral.">
    
    <!-- Open Graph / LinkedIn -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="RV Profile Studio | An√°lisis Profesional de CV">
    <meta property="og:description" content="Descubre tu puntuaci√≥n profesional, fortalezas y √°reas de mejora. An√°lisis gratuito en 30 segundos.">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/c4943f/ffffff?text=RV+Profile+Studio">
    <meta property="og:url" content="https://rozoca.github.io/RV_PROFILE_STUDIO/">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="RV Profile Studio | An√°lisis Profesional de CV">
    <meta name="twitter:description" content="Descubre tu puntuaci√≥n profesional, fortalezas y √°reas de mejora. An√°lisis gratuito en 30 segundos.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    
    <!-- Google Analytics - REEMPLAZA G-XXXXXXXXXX con tu ID -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F1TPPD752G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-F1TPPD752G');
        
        // Eventos personalizados para tracking
        function trackEvent(action, category, label) {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, { event_category: category, event_label: label });
            }
        }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --gold-50: #fefdfb; --gold-100: #fdf9f0; --gold-200: #f9f0db;
            --gold-400: #e4c378; --gold-500: #d4a853; --gold-600: #c4943f; --gold-700: #a37633;
            --slate-100: #f1f5f9; --slate-200: #e2e8f0; --slate-300: #cbd5e1;
            --slate-400: #94a3b8; --slate-500: #64748b; --slate-600: #475569;
            --slate-700: #334155; --slate-800: #1e293b; --slate-900: #0f172a;
            --bg-primary: var(--gold-50); --bg-card: #ffffff;
            --text-primary: var(--slate-900); --text-secondary: var(--slate-600); --text-muted: var(--slate-400);
            --brand: var(--gold-600); --brand-dark: var(--gold-700); --brand-light: var(--gold-200);
            --success: #059669; --success-bg: #ecfdf5;
            --warning: #d97706; --warning-bg: #fffbeb;
            --danger: #dc2626; --danger-bg: #fef2f2;
            --info: #0284c7; --info-bg: #f0f9ff;
            --font-display: 'Cormorant Garamond', Georgia, serif;
            --font-body: 'DM Sans', -apple-system, sans-serif;
            --space-xs: 4px; --space-sm: 8px; --space-md: 16px; --space-lg: 24px; --space-xl: 32px; --space-2xl: 48px;
            --radius-sm: 6px; --radius-md: 12px; --radius-lg: 20px;
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06); --shadow-lg: 0 12px 40px rgba(0,0,0,0.08);
            --transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        [data-theme="dark"] {
            --bg-primary: #0c0c0c; --bg-card: #161616;
            --text-primary: #f1f5f9; --text-secondary: #94a3b8; --text-muted: #64748b;
            --brand-light: rgba(212, 168, 83, 0.15);
            --success-bg: rgba(5, 150, 105, 0.15); --warning-bg: rgba(217, 119, 6, 0.15);
            --danger-bg: rgba(220, 38, 38, 0.15); --info-bg: rgba(2, 132, 199, 0.15);
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-body); font-size: 16px; line-height: 1.7;
            color: var(--text-primary); background: var(--bg-primary); min-height: 100vh;
            transition: background var(--transition), color var(--transition);
        }
        h1, h2, h3, h4 { font-family: var(--font-display); font-weight: 600; line-height: 1.3; }
        ::selection { background: var(--brand); color: white; }
        a { color: var(--brand); text-decoration: none; }
        a:hover { text-decoration: underline; }
        
        .app-wrapper { max-width: 1100px; margin: 0 auto; padding: var(--space-lg); }
        @media (min-width: 768px) { .app-wrapper { padding: var(--space-2xl); } }
        
        /* Disclaimer Banner */
        .disclaimer-banner {
            background: var(--warning-bg); border: 1px solid var(--warning);
            border-radius: var(--radius-md); padding: var(--space-md);
            margin-bottom: var(--space-lg); font-size: 0.85rem; color: var(--slate-700);
            display: flex; align-items: flex-start; gap: var(--space-sm);
        }
        [data-theme="dark"] .disclaimer-banner { color: var(--slate-200); }
        .disclaimer-banner strong { color: var(--warning); }
        .disclaimer-icon { font-size: 1.2rem; flex-shrink: 0; }
        
        /* Header */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: var(--space-lg) 0; margin-bottom: var(--space-lg);
            border-bottom: 1px solid var(--brand-light);
        }
        .logo { display: flex; align-items: baseline; gap: var(--space-xs); }
        .logo-mark { font-family: var(--font-display); font-size: 2.2rem; font-weight: 700; color: var(--brand); }
        .logo-text { font-family: var(--font-display); font-size: 1.4rem; color: var(--text-primary); letter-spacing: 1px; }
        .logo-version { font-size: 0.7rem; color: var(--text-muted); margin-left: var(--space-xs); }
        .header-controls { display: flex; align-items: center; gap: var(--space-md); }
        .lang-select, .theme-toggle {
            font-family: var(--font-body); font-size: 0.875rem; padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--text-muted); border-radius: var(--radius-sm);
            background: transparent; color: var(--text-primary); cursor: pointer;
        }
        .theme-toggle { width: 40px; height: 40px; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; }
        
        /* Hero Section */
        .hero {
            text-align: center; padding: var(--space-xl) 0; margin-bottom: var(--space-lg);
        }
        .hero h1 { font-size: 2.2rem; margin-bottom: var(--space-md); }
        .hero p { font-size: 1.1rem; color: var(--text-secondary); max-width: 600px; margin: 0 auto; }
        .hero-badges { display: flex; justify-content: center; gap: var(--space-md); margin-top: var(--space-lg); flex-wrap: wrap; }
        .hero-badge { 
            display: inline-flex; align-items: center; gap: var(--space-xs);
            padding: var(--space-xs) var(--space-md); background: var(--bg-card);
            border-radius: var(--radius-lg); font-size: 0.85rem; color: var(--text-secondary);
            border: 1px solid var(--slate-200);
        }
        
        /* Panels */
        .panel { display: none; animation: fadeIn 0.4s ease; }
        .panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Cards */
        .card {
            background: var(--bg-card); border-radius: var(--radius-lg); padding: var(--space-xl);
            margin-bottom: var(--space-lg); box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.04);
        }
        [data-theme="dark"] .card { border-color: rgba(255,255,255,0.05); }
        .card-title { font-size: 1.35rem; margin-bottom: var(--space-sm); display: flex; align-items: center; gap: var(--space-sm); }
        .card-subtitle { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: var(--space-lg); }
        
        /* Forms */
        .form-group { margin-bottom: var(--space-lg); }
        .form-label { display: block; font-weight: 500; font-size: 0.9rem; margin-bottom: var(--space-sm); }
        .form-input, .form-textarea {
            width: 100%; padding: var(--space-md); font-family: var(--font-body); font-size: 1rem;
            color: var(--text-primary); background: var(--bg-primary);
            border: 1px solid var(--slate-300); border-radius: var(--radius-md); transition: all var(--transition);
        }
        [data-theme="dark"] .form-input, [data-theme="dark"] .form-textarea { border-color: var(--slate-700); }
        .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--brand); box-shadow: 0 0 0 3px var(--brand-light); }
        .form-textarea { min-height: 200px; resize: vertical; line-height: 1.6; }
        .form-hint { font-size: 0.8rem; color: var(--text-muted); margin-top: var(--space-xs); }
        .form-error { color: var(--danger); font-size: 0.85rem; margin-top: var(--space-xs); display: none; }
        .form-group.error .form-error { display: block; }
        .form-group.error .form-textarea { border-color: var(--danger); }
        
        /* Option Grid */
        .option-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(155px, 1fr)); gap: var(--space-sm); }
        .option-pill {
            padding: var(--space-md); border: 1px solid var(--slate-300); border-radius: var(--radius-md);
            text-align: center; font-size: 0.85rem; font-weight: 500; cursor: pointer;
            transition: all var(--transition); background: var(--bg-card);
        }
        [data-theme="dark"] .option-pill { border-color: var(--slate-700); }
        .option-pill:hover { border-color: var(--brand); color: var(--brand); }
        .option-pill.selected { background: var(--brand); border-color: var(--brand); color: white; }
        .option-pill.recommended { position: relative; }
        .option-pill.recommended::after {
            content: '‚≠ê'; position: absolute; top: -8px; right: -8px; font-size: 0.9rem;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: var(--space-sm);
            padding: var(--space-md) var(--space-xl); font-family: var(--font-body); font-size: 1rem;
            font-weight: 600; border-radius: var(--radius-md); cursor: pointer; transition: all var(--transition); border: none;
        }
        .btn-primary { background: var(--brand); color: white; width: 100%; }
        .btn-primary:hover { background: var(--brand-dark); transform: translateY(-2px); }
        .btn-primary:disabled { background: var(--text-muted); cursor: not-allowed; transform: none; }
        .btn-secondary { background: transparent; border: 2px solid var(--brand); color: var(--brand); }
        .btn-secondary:hover { background: var(--brand-light); }
        .btn-ghost { background: transparent; color: var(--text-secondary); padding: var(--space-sm) var(--space-md); }
        .btn-ghost:hover { color: var(--brand); background: var(--brand-light); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #047857; }
        .btn-group { display: flex; gap: var(--space-md); margin-top: var(--space-lg); flex-wrap: wrap; }
        .btn-group .btn { flex: 1; min-width: 180px; }
        
        /* Results Header */
        .results-header {
            text-align: center; padding: var(--space-2xl) var(--space-lg);
            background: var(--bg-card); border-radius: var(--radius-lg); margin-bottom: var(--space-lg);
        }
        .results-brand { margin-bottom: var(--space-lg); }
        .results-date { font-size: 0.85rem; color: var(--text-muted); margin-bottom: var(--space-md); }
        .score-circle { position: relative; width: 200px; height: 200px; margin: 0 auto var(--space-lg); }
        .score-canvas { position: absolute; top: 0; left: 0; }
        .score-value {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-family: var(--font-display); font-size: 3.5rem; font-weight: 700; color: var(--brand);
        }
        .score-label { font-size: 1.1rem; color: var(--text-secondary); margin-bottom: var(--space-md); }
        .score-interpretation {
            display: inline-block; padding: var(--space-sm) var(--space-lg);
            background: var(--brand-light); border-radius: var(--radius-lg); font-weight: 600; color: var(--brand-dark);
        }
        .profile-meta {
            display: flex; justify-content: center; gap: var(--space-xl); margin-top: var(--space-lg);
            padding-top: var(--space-lg); border-top: 1px solid var(--slate-200); flex-wrap: wrap;
        }
        .meta-item { text-align: center; }
        .meta-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: var(--space-xs); }
        .meta-value { font-weight: 600; }
        
        /* Dashboard */
        .dashboard-grid { display: grid; gap: var(--space-lg); }
        @media (min-width: 768px) { .dashboard-grid { grid-template-columns: 1fr 1fr; } }
        
        /* Metrics */
        .metric-item { display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-md); }
        .metric-label { width: 130px; font-size: 0.85rem; font-weight: 500; flex-shrink: 0; }
        .metric-bar { flex-grow: 1; height: 12px; background: var(--slate-200); border-radius: 6px; overflow: hidden; }
        [data-theme="dark"] .metric-bar { background: var(--slate-700); }
        .metric-fill { height: 100%; border-radius: 6px; transition: width 1s ease; }
        .metric-value { width: 45px; text-align: right; font-weight: 600; font-size: 0.9rem; }
        
        /* SWOT */
        .swot-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md); }
        @media (max-width: 600px) { .swot-grid { grid-template-columns: 1fr; } }
        .swot-card { padding: var(--space-lg); border-radius: var(--radius-md); }
        .swot-strengths { background: var(--success-bg); border-left: 4px solid var(--success); }
        .swot-weaknesses { background: var(--danger-bg); border-left: 4px solid var(--danger); }
        .swot-opportunities { background: var(--info-bg); border-left: 4px solid var(--info); }
        .swot-threats { background: var(--warning-bg); border-left: 4px solid var(--warning); }
        .swot-title { font-size: 1rem; font-weight: 600; margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-sm); }
        .swot-list { list-style: none; }
        .swot-list li { position: relative; padding-left: var(--space-lg); margin-bottom: var(--space-sm); font-size: 0.9rem; line-height: 1.6; }
        .swot-list li::before { content: ''; position: absolute; left: 0; top: 10px; width: 6px; height: 6px; border-radius: 50%; background: currentColor; }
        
        /* Recommendations */
        .rec-list { list-style: none; }
        .rec-item { display: flex; gap: var(--space-md); padding: var(--space-md); background: var(--bg-primary); border-radius: var(--radius-md); margin-bottom: var(--space-sm); }
        .rec-priority { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.8rem; flex-shrink: 0; }
        .rec-priority.high { background: var(--danger); color: white; }
        .rec-priority.medium { background: var(--warning); color: white; }
        .rec-priority.low { background: var(--success); color: white; }
        .rec-content { flex-grow: 1; }
        .rec-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 2px; }
        .rec-desc { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }
        
        /* Tags */
        .tag-list { display: flex; flex-wrap: wrap; gap: var(--space-sm); }
        .tag { padding: var(--space-xs) var(--space-md); border-radius: var(--radius-lg); font-size: 0.8rem; font-weight: 500; }
        .tag.match { background: var(--success-bg); color: var(--success); }
        .tag.gap { background: var(--danger-bg); color: var(--danger); }
        
        /* Synthesis */
        .synthesis-text { font-size: 1rem; line-height: 1.9; color: var(--text-secondary); }
        .synthesis-text strong { color: var(--text-primary); font-weight: 600; }
        
        /* Chart */
        .chart-container { position: relative; height: 280px; margin-bottom: var(--space-lg); }
        
        /* Job Fit Section */
        .jobfit-card { border: 2px solid var(--info); }
        .jobfit-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--space-md); }
        .jobfit-score { font-family: var(--font-display); font-size: 2.5rem; font-weight: 700; color: var(--info); }
        .fit-grid { display: grid; gap: var(--space-lg); margin-top: var(--space-lg); }
        @media (min-width: 768px) { .fit-grid { grid-template-columns: 1fr 1fr; } }
        .fit-section-title { font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: var(--space-md); }
        
        /* CTA */
        .cta-card { background: linear-gradient(135deg, var(--brand) 0%, var(--brand-dark) 100%); color: white; text-align: center; }
        .cta-card .card-title { color: white; justify-content: center; }
        .cta-card p { opacity: 0.9; margin-bottom: var(--space-lg); }
        .cta-card .btn { background: white; color: var(--brand-dark); }
        
        /* Footer */
        .results-footer { text-align: center; padding: var(--space-lg); margin-top: var(--space-lg); border-top: 1px solid var(--slate-200); font-size: 0.85rem; color: var(--text-muted); }
        .results-footer a { color: var(--brand); }
        
        /* App Footer */
        .app-footer {
            text-align: center; padding: var(--space-xl) 0; margin-top: var(--space-2xl);
            border-top: 1px solid var(--slate-200); font-size: 0.85rem; color: var(--text-muted);
        }
        .app-footer-links { display: flex; justify-content: center; gap: var(--space-lg); margin-bottom: var(--space-md); flex-wrap: wrap; }
        
        /* Share buttons */
        .share-buttons { display: flex; justify-content: center; gap: var(--space-md); margin-top: var(--space-lg); }
        .share-btn {
            padding: var(--space-sm) var(--space-md); border-radius: var(--radius-md);
            font-size: 0.85rem; font-weight: 500; cursor: pointer; border: none;
            display: inline-flex; align-items: center; gap: var(--space-xs);
        }
        .share-btn.whatsapp { background: #25D366; color: white; }
        .share-btn.twitter { background: #1da1f2; color: white; }
        .share-btn.copy { background: var(--slate-200); color: var(--slate-700); }
        
        /* Loading */
        .loader-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 9999;
            display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        [data-theme="dark"] .loader-overlay { background: rgba(0,0,0,0.95); }
        .loader-overlay.active { display: flex; }
        .spinner { width: 56px; height: 56px; border: 4px solid var(--brand-light); border-top-color: var(--brand); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader-text { margin-top: var(--space-lg); font-size: 1.1rem; color: var(--text-secondary); }
        
        /* Utilities */
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .mt-lg { margin-top: var(--space-lg); }
        .mb-lg { margin-bottom: var(--space-lg); }
        .hidden { display: none !important; }
        
        /* Print */
        @media print {
            .header-controls, .btn-group, .cta-card, #panelInput, #jobFitInputCard, .disclaimer-banner, .share-buttons, .app-footer { display: none !important; }
            .card { box-shadow: none !important; break-inside: avoid; }
            body { background: white !important; }
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .header { flex-direction: column; gap: var(--space-md); text-align: center; }
            .hero h1 { font-size: 1.8rem; }
            .card { padding: var(--space-lg); }
            .score-value { font-size: 2.5rem; }
            .btn-group { flex-direction: column; }
            .btn-group .btn { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="loader-overlay" id="loader">
        <div class="spinner"></div>
        <p class="loader-text" id="loaderText">Analizando perfil...</p>
    </div>

    <div class="app-wrapper">
        
        <!-- Disclaimer -->
        <div class="disclaimer-banner">
            <span class="disclaimer-icon">‚ö†Ô∏è</span>
            <div>
                <strong>Herramienta orientativa.</strong> Los resultados son una aproximaci√≥n algor√≠tmica basada en el an√°lisis de palabras clave y estructura del CV. No sustituyen el criterio profesional de RRHH ni garantizan resultados en procesos de selecci√≥n.
            </div>
        </div>
        
        <header class="header">
            <div class="logo">
                <span class="logo-mark">RV</span>
                <span class="logo-text">Profile Studio</span>
                <span class="logo-version">v4.1</span>
            </div>
            <div class="header-controls">
                <select class="lang-select" id="langSelect" onchange="changeLang(this.value)">
                    <option value="es">Espa√±ol</option>
                    <option value="en">English</option>
                    <option value="pt">Portugu√™s</option>
                </select>
                <button class="theme-toggle" onclick="toggleTheme()" aria-label="Cambiar tema"><span id="themeIcon">üåô</span></button>
            </div>
        </header>

        <!-- PANEL 1: INPUT -->
        <section class="panel active" id="panelInput">
            
            <div class="hero">
                <h1>Descubre el potencial de tu perfil profesional</h1>
                <p>Analiza tu CV en 30 segundos y obt√©n recomendaciones personalizadas para destacar en el mercado laboral.</p>
                <div class="hero-badges">
                    <span class="hero-badge">‚úÖ Gratuito</span>
                    <span class="hero-badge">üîí Privado (no guardamos datos)</span>
                    <span class="hero-badge">‚ö° Resultados en segundos</span>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">üéØ <span data-i18n="sector_title">Sector Profesional</span></h2>
                <p class="card-subtitle" data-i18n="sector_subtitle">Selecciona tu √°rea de especializaci√≥n principal</p>
                <div class="option-grid" id="sectorGrid"></div>
            </div>

            <div class="card">
                <h2 class="card-title">üìä <span data-i18n="level_title">Nivel de Experiencia</span></h2>
                <p class="card-subtitle">A√±os de experiencia profesional total</p>
                <div class="option-grid" id="levelGrid"></div>
            </div>

            <div class="card">
                <h2 class="card-title">üìÑ <span data-i18n="cv_title">Tu Curr√≠culum</span></h2>
                <p class="card-subtitle" data-i18n="cv_subtitle">Copia y pega el contenido completo de tu CV (texto plano)</p>
                <div class="form-group" id="cvGroup">
                    <textarea class="form-textarea" id="cvInput" placeholder="Pega aqu√≠ el texto de tu curr√≠culum..."></textarea>
                    <p class="form-error">Por favor, introduce al menos 200 caracteres de tu CV.</p>
                    <div style="display: flex; justify-content: space-between; margin-top: var(--space-sm);">
                        <button class="btn-ghost" onclick="loadExample()">üìã Cargar ejemplo</button>
                        <span class="form-hint" id="charCount">0 caracteres</span>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="runProfileAnalysis()" id="analyzeBtn">
                üîç <span data-i18n="analyze_btn">Analizar mi Perfil</span>
            </button>
        </section>

        <!-- PANEL 2: RESULTS -->
        <section class="panel" id="panelResults">
            
            <!-- Action Buttons -->
            <div class="btn-group" style="margin-bottom: var(--space-xl);">
                <button class="btn btn-secondary" onclick="showInput()">
                    ‚Üê <span data-i18n="back_btn">Editar CV</span>
                </button>
                <button class="btn btn-success" onclick="toggleJobFit()" id="jobFitToggleBtn">
                    üéØ <span data-i18n="add_jobfit">Comparar con oferta</span>
                </button>
                <button class="btn btn-primary" onclick="generatePDF()">
                    üì• <span data-i18n="download_pdf">Descargar PDF</span>
                </button>
            </div>

            <!-- Job Fit Input (hidden by default) -->
            <div class="card hidden" id="jobFitInputCard">
                <h2 class="card-title">üíº <span data-i18n="job_title">Descripci√≥n del Puesto</span></h2>
                <p class="card-subtitle" data-i18n="job_subtitle">Pega la oferta de trabajo para calcular tu compatibilidad</p>
                <textarea class="form-textarea" id="jobInput" placeholder="Copia aqu√≠ la descripci√≥n completa del puesto..."></textarea>
                <div class="btn-group">
                    <button class="btn btn-ghost" onclick="toggleJobFit()">Cancelar</button>
                    <button class="btn btn-success" onclick="runJobFitAnalysis()">üéØ Calcular compatibilidad</button>
                </div>
            </div>

            <!-- Results Content -->
            <div id="resultsContent">
                
                <!-- Header with Score -->
                <div class="results-header" id="resultsHeader">
                    <div class="results-brand">
                        <div class="logo" style="justify-content: center;">
                            <span class="logo-mark">RV</span>
                            <span class="logo-text">Profile Studio</span>
                        </div>
                    </div>
                    <p class="results-date" id="resultsDate"></p>
                    
                    <div class="score-circle">
                        <canvas id="scoreGauge" class="score-canvas" width="200" height="200"></canvas>
                        <div class="score-value" id="mainScore">0%</div>
                    </div>
                    <p class="score-label" id="scoreLabel">Puntuaci√≥n del Perfil</p>
                    <span class="score-interpretation" id="scoreInterpretation">Calculando...</span>
                    
                    <div class="profile-meta">
                        <div class="meta-item">
                            <p class="meta-label">Sector</p>
                            <p class="meta-value" id="metaSector">-</p>
                        </div>
                        <div class="meta-item">
                            <p class="meta-label">Nivel</p>
                            <p class="meta-value" id="metaLevel">-</p>
                        </div>
                        <div class="meta-item">
                            <p class="meta-label">Experiencia</p>
                            <p class="meta-value" id="metaYears">-</p>
                        </div>
                    </div>
                    
                    <!-- Share -->
                    <div class="share-buttons">
                        <button class="share-btn whatsapp" onclick="shareWhatsApp()">üì± Compartir en WhatsApp</button>
                        <button class="share-btn copy" onclick="copyResults()">üìã Copiar resultado</button>
                    </div>
                </div>

                <!-- Synthesis -->
                <div class="card" id="synthesisCard">
                    <h3 class="card-title">üìù S√≠ntesis Ejecutiva</h3>
                    <p class="synthesis-text" id="synthesisText"></p>
                </div>

                <div class="dashboard-grid">
                    <div>
                        <!-- Competencies -->
                        <div class="card" id="competenciesCard">
                            <h3 class="card-title">üìà Competencias</h3>
                            <div class="chart-container"><canvas id="radarChart"></canvas></div>
                            <div id="metricsContainer"></div>
                        </div>
                    </div>

                    <div>
                        <!-- SWOT -->
                        <div class="card" id="swotCard">
                            <h3 class="card-title mb-lg">üéØ An√°lisis DAFO</h3>
                            <div class="swot-grid">
                                <div class="swot-card swot-strengths">
                                    <div class="swot-title text-success">üí™ Fortalezas</div>
                                    <ul class="swot-list" id="strengthsList"></ul>
                                </div>
                                <div class="swot-card swot-weaknesses">
                                    <div class="swot-title text-danger">‚ö†Ô∏è √Åreas de mejora</div>
                                    <ul class="swot-list" id="weaknessesList"></ul>
                                </div>
                                <div class="swot-card swot-opportunities">
                                    <div class="swot-title" style="color: var(--info);">üöÄ Oportunidades</div>
                                    <ul class="swot-list" id="opportunitiesList"></ul>
                                </div>
                                <div class="swot-card swot-threats">
                                    <div class="swot-title text-warning">üîç Desaf√≠os</div>
                                    <ul class="swot-list" id="threatsList"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="card" id="recommendationsCard">
                    <h3 class="card-title">üéØ Plan de Acci√≥n Personalizado</h3>
                    <ul class="rec-list" id="recommendationsList"></ul>
                </div>

                <!-- Job Fit Results (shown after analysis) -->
                <div class="card jobfit-card hidden" id="jobFitResults">
                    <div class="jobfit-header">
                        <div>
                            <h3 class="card-title" style="margin-bottom: 0;">üéØ Compatibilidad con el Puesto</h3>
                            <p class="card-subtitle" style="margin-bottom: 0;" id="jobFitPosition"></p>
                        </div>
                        <div class="jobfit-score" id="jobFitScore">--%</div>
                    </div>
                    
                    <div class="fit-grid">
                        <div>
                            <p class="fit-section-title">‚úÖ Requisitos que cumples</p>
                            <div class="tag-list" id="matchingSkills"></div>
                        </div>
                        <div>
                            <p class="fit-section-title">üìö √Åreas a desarrollar</p>
                            <div class="tag-list" id="gapSkills"></div>
                        </div>
                    </div>
                    
                    <div class="mt-lg">
                        <h4 style="font-size: 1rem; margin-bottom: var(--space-sm);">üí° Estrategia para esta candidatura</h4>
                        <p class="synthesis-text" id="fitStrategy"></p>
                    </div>
                </div>

                <!-- Footer -->
                <div class="results-footer" id="resultsFooter">
                    <p>Generado con <strong>RV Profile Studio</strong> | <a href="mailto:rvprofilestudio@gmail.com">rvprofilestudio@gmail.com</a></p>
                    <p style="margin-top: 5px; font-size: 0.75rem; color: var(--text-muted);">
                        ‚ö†Ô∏è An√°lisis orientativo basado en algoritmos. No sustituye el criterio profesional.
                    </p>
                </div>
            </div>

            <!-- CTA -->
            <div class="card cta-card mt-lg">
                <h3 class="card-title">¬øQuieres un an√°lisis m√°s profundo?</h3>
                <p>Agenda una sesi√≥n de consultor√≠a personalizada para revisar tu perfil y estrategia de carrera.</p>
                <button class="btn" onclick="contact()">üìß Solicitar consultor√≠a</button>
            </div>
        </section>
        
        <!-- App Footer -->
        <footer class="app-footer">
            <div class="app-footer-links">
                <a href="mailto:rvprofilestudio@gmail.com">Contacto</a>
                <span>|</span>
                <a href="#" onclick="showPrivacy(); return false;">Privacidad</a>
                <span>|</span>
                <span>¬© 2025 RV Profile Studio</span>
            </div>
            <p>Desarrollado con ‚ù§Ô∏è para profesionales que buscan destacar</p>
        </footer>
    </div>

    <script>
        // ============================================
        // RV PROFILE STUDIO v4.1 - LAUNCH READY
        // ============================================

        const CONFIG = { 
            email: 'rvprofilestudio@gmail.com', 
            version: '4.1.0',
            url: window.location.href
        };

        let state = {
            lang: 'es',
            sector: null,
            level: null,
            cv: '',
            job: '',
            profile: null,
            jobFit: null,
            extracted: null,
            charts: {}
        };

        // --- i18n ---
        const i18n = {
            es: {
                sector_title: 'Sector Profesional', sector_subtitle: 'Selecciona tu √°rea de especializaci√≥n principal',
                level_title: 'Nivel de Experiencia', cv_title: 'Tu Curr√≠culum',
                cv_subtitle: 'Copia y pega el contenido completo de tu CV (texto plano)',
                analyze_btn: 'Analizar mi Perfil', back_btn: 'Editar CV',
                add_jobfit: 'Comparar con oferta', download_pdf: 'Descargar PDF',
                job_title: 'Descripci√≥n del Puesto', job_subtitle: 'Pega la oferta de trabajo para calcular tu compatibilidad',
                loading: 'Analizando perfil...', loading_fit: 'Calculando compatibilidad...',
                error_sector: 'Selecciona un sector profesional', error_level: 'Selecciona tu nivel de experiencia',
                error_cv: 'El CV debe tener al menos 200 caracteres', error_job: 'Pega la descripci√≥n del puesto',
                years: 'a√±os', copied: '¬°Copiado!'
            },
            en: {
                sector_title: 'Professional Sector', sector_subtitle: 'Select your main area of expertise',
                level_title: 'Experience Level', cv_title: 'Your Resume',
                cv_subtitle: 'Copy and paste your complete CV content (plain text)',
                analyze_btn: 'Analyze my Profile', back_btn: 'Edit CV',
                add_jobfit: 'Compare with job', download_pdf: 'Download PDF',
                job_title: 'Job Description', job_subtitle: 'Paste the job offer to calculate your fit',
                loading: 'Analyzing profile...', loading_fit: 'Calculating compatibility...',
                error_sector: 'Select a professional sector', error_level: 'Select your experience level',
                error_cv: 'CV must have at least 200 characters', error_job: 'Paste the job description',
                years: 'years', copied: 'Copied!'
            },
            pt: {
                sector_title: 'Setor Profissional', sector_subtitle: 'Selecione sua principal √°rea de especializa√ß√£o',
                level_title: 'N√≠vel de Experi√™ncia', cv_title: 'Seu Curr√≠culo',
                cv_subtitle: 'Copie e cole o conte√∫do completo do seu CV (texto simples)',
                analyze_btn: 'Analisar meu Perfil', back_btn: 'Editar CV',
                add_jobfit: 'Comparar com vaga', download_pdf: 'Baixar PDF',
                job_title: 'Descri√ß√£o da Vaga', job_subtitle: 'Cole a oferta de trabalho para calcular sua compatibilidade',
                loading: 'Analisando perfil...', loading_fit: 'Calculando compatibilidade...',
                error_sector: 'Selecione um setor profissional', error_level: 'Selecione seu n√≠vel de experi√™ncia',
                error_cv: 'O CV deve ter pelo menos 200 caracteres', error_job: 'Cole a descri√ß√£o da vaga',
                years: 'anos', copied: 'Copiado!'
            }
        };

        function t(key) { return i18n[state.lang][key] || key; }

        // --- SECTORS (REFINED KEYWORDS) ---
        const sectors = {
            banking_ops: { 
                label: { es: 'Banking Operations', en: 'Banking Operations', pt: 'Banking Operations' },
                recommended: true,
                keywords: [
                    // Core Operations
                    'banking operations', 'operations excellence', 'service delivery', 'service excellence',
                    'back office', 'middle office', 'front office', 'operations manager', 'head of operations',
                    // Metrics & Quality
                    'sla', 'kpi', 'operational risk', 'quality assurance', 'process efficiency',
                    'error rate', 'processing time', 'turnaround time', 'accuracy',
                    // Compliance & Risk
                    'compliance', 'regulatory', 'aml', 'kyc', 'sanctions', 'fraud', 'audit',
                    'internal controls', 'risk management', 'governance',
                    // Processes
                    'reconciliation', 'settlement', 'clearing', 'custody', 'account opening',
                    'customer service', 'incident management', 'escalation',
                    // Outsourcing
                    'bpo', 'outsourcing', 'offshoring', 'nearshoring', 'vendor management',
                    'service provider', 'third party', 'hub', 'shared services',
                    // Technology
                    'core banking', 'digital banking', 'fintech', 'neobank', 'automation', 'rpa',
                    'digitization', 'straight-through processing', 'stp',
                    // Leadership
                    'team management', 'people management', 'stakeholder management',
                    'cross-functional', 'continuous improvement', 'transformation'
                ]
            },
            payments: { 
                label: { es: 'Pagos / Treasury', en: 'Payments / Treasury', pt: 'Pagamentos / Treasury' },
                recommended: true,
                keywords: [
                    // Payment Systems
                    'payments', 'payment systems', 'payment operations', 'payment processing',
                    'swift', 'sepa', 'sepa instant', 'instant payments', 'real-time payments',
                    'target2', 'target', 'eba clearing', 'step2', 'tips',
                    // ISO Standards
                    'iso20022', 'iso 20022', 'cbpr+', 'cbpr', 'mx messages', 'mt messages',
                    'pacs', 'pain', 'camt', 'migration',
                    // Treasury
                    'treasury', 'treasury operations', 'cash management', 'liquidity',
                    'liquidity management', 'cash pooling', 'cash forecasting',
                    // Correspondent Banking
                    'correspondent banking', 'nostro', 'vostro', 'loro',
                    'fx', 'foreign exchange', 'wire transfer', 'cross-border',
                    // Types
                    'ach', 'rtgs', 'direct debit', 'direct credit', 'batch',
                    'urgent payments', 'high value', 'low value', 'bulk payments',
                    // Regulatory
                    'psd2', 'psd3', 'psr', 'open banking', 'api banking',
                    // Innovation
                    'euro digital', 'digital euro', 'cbdc', 'central bank digital currency',
                    'blockchain', 'dlt', 'cryptocurrency', 'stablecoin',
                    // Cards
                    'card payments', 'acquiring', 'issuing', 'visa', 'mastercard',
                    // Processes
                    'exceptions', 'investigations', 'sanctions screening', 'payment hub',
                    'payment gateway', 'payment factory'
                ]
            },
            transformation: { 
                label: { es: 'Transformaci√≥n / Change', en: 'Transformation / Change', pt: 'Transforma√ß√£o / Change' },
                recommended: true,
                keywords: [
                    // Change Management
                    'change management', 'change lead', 'change manager', 'organizational change',
                    'transformation', 'digital transformation', 'business transformation',
                    'transformation office', 'transformation lead',
                    // Methodologies
                    'prosci', 'adkar', 'kotter', 'lewin', 'change curve',
                    'stakeholder engagement', 'resistance management', 'adoption',
                    // Lean & Continuous Improvement
                    'lean', 'lean management', 'lean six sigma', 'six sigma',
                    'dmaic', 'define measure analyze improve control',
                    'kaizen', 'continuous improvement', 'process improvement',
                    'value stream mapping', 'vsm', 'sipoc', 'gemba',
                    'root cause analysis', 'rca', '5 whys', 'fishbone', 'pareto',
                    // Process
                    'bpr', 'business process reengineering', 'process redesign',
                    'as-is', 'to-be', 'gap analysis', 'current state', 'future state',
                    'operating model', 'target operating model', 'tom',
                    // Agile
                    'agile', 'agile transformation', 'scrum', 'kanban', 'safe',
                    // Strategy
                    'strategic', 'roadmap', 'business case', 'roi',
                    'kpi', 'okr', 'metrics', 'balanced scorecard',
                    // People
                    'training', 'enablement', 'communication plan', 'culture change',
                    'organizational design', 'org design', 'ways of working'
                ]
            },
            pm: { 
                label: { es: 'Project Management', en: 'Project Management', pt: 'Project Management' },
                keywords: [
                    'project management', 'project manager', 'program management', 'programme management',
                    'pmp', 'prince2', 'pmbok', 'pmo', 'project office',
                    'agile', 'scrum', 'scrum master', 'kanban', 'waterfall', 'hybrid',
                    'jira', 'confluence', 'ms project', 'azure devops', 'asana', 'monday',
                    'gantt', 'wbs', 'work breakdown', 'critical path', 'pert',
                    'risk management', 'issue management', 'dependency', 'milestone',
                    'stakeholder', 'steering committee', 'governance',
                    'budget', 'cost control', 'resource management', 'capacity',
                    'scope', 'timeline', 'deliverable', 'sprint', 'backlog',
                    'earned value', 'evm', 'status report', 'dashboard'
                ]
            },
            product: { 
                label: { es: 'Product Management', en: 'Product Management', pt: 'Product Management' },
                keywords: [
                    'product management', 'product manager', 'product owner', 'po',
                    'product strategy', 'product vision', 'product roadmap',
                    'backlog', 'user stories', 'epics', 'features', 'requirements',
                    'mvp', 'minimum viable product', 'product-market fit',
                    'customer discovery', 'user research', 'market research',
                    'competitive analysis', 'value proposition', 'positioning',
                    'prioritization', 'moscow', 'rice', 'weighted scoring',
                    'a/b testing', 'experimentation', 'metrics', 'kpi', 'okr',
                    'north star', 'funnel', 'retention', 'engagement', 'nps',
                    'go-to-market', 'gtm', 'launch', 'release',
                    'agile', 'scrum', 'kanban', 'jira', 'confluence',
                    'saas', 'b2b', 'b2c', 'platform', 'api'
                ]
            },
            tech: { 
                label: { es: 'Tecnolog√≠a / IT', en: 'Technology / IT', pt: 'Tecnologia / TI' },
                keywords: [
                    'software', 'development', 'developer', 'engineer', 'engineering',
                    'programming', 'coding', 'javascript', 'typescript', 'python', 'java', 'c#',
                    'react', 'angular', 'vue', 'node', 'spring', '.net',
                    'sql', 'nosql', 'database', 'mongodb', 'postgresql', 'mysql', 'oracle',
                    'aws', 'azure', 'gcp', 'cloud', 'infrastructure',
                    'docker', 'kubernetes', 'k8s', 'microservices', 'serverless',
                    'api', 'rest', 'graphql', 'integration',
                    'ci/cd', 'devops', 'gitops', 'git', 'jenkins', 'terraform',
                    'testing', 'qa', 'automation', 'unit test', 'integration test',
                    'architecture', 'system design', 'scalability', 'performance',
                    'security', 'cybersecurity', 'networking',
                    'machine learning', 'ml', 'ai', 'data science', 'data engineering'
                ]
            },
            data: { 
                label: { es: 'Data / Analytics', en: 'Data / Analytics', pt: 'Data / Analytics' },
                keywords: [
                    'data analytics', 'data analysis', 'business intelligence', 'bi',
                    'data science', 'data scientist', 'data analyst', 'analytics',
                    'power bi', 'tableau', 'looker', 'qlik', 'metabase',
                    'sql', 'python', 'r', 'pandas', 'numpy',
                    'data visualization', 'dashboards', 'reporting', 'insights',
                    'kpi', 'metrics', 'data-driven', 'decision making',
                    'etl', 'data pipeline', 'data warehouse', 'data lake',
                    'big data', 'spark', 'hadoop', 'databricks', 'snowflake', 'dbt',
                    'data modeling', 'data governance', 'data quality', 'master data',
                    'machine learning', 'predictive analytics', 'forecasting',
                    'a/b testing', 'experimentation', 'statistical analysis'
                ]
            },
            consulting: { 
                label: { es: 'Consultor√≠a', en: 'Consulting', pt: 'Consultoria' },
                keywords: [
                    'consulting', 'consultant', 'management consulting', 'strategy consulting',
                    'advisory', 'advisor', 'implementation', 'delivery',
                    'due diligence', 'business case', 'feasibility',
                    'market analysis', 'competitive analysis', 'benchmarking',
                    'best practices', 'frameworks', 'methodology',
                    'deliverables', 'workstreams', 'workstream lead',
                    'client', 'engagement', 'proposal', 'rfp',
                    'project management', 'change management', 'stakeholder',
                    'workshop', 'facilitation', 'presentation', 'executive summary',
                    'thought leadership', 'white paper', 'point of view'
                ]
            },
            finance: { 
                label: { es: 'Finanzas', en: 'Finance', pt: 'Finan√ßas' },
                keywords: [
                    'financial analysis', 'finance', 'fp&a', 'financial planning',
                    'budgeting', 'forecasting', 'reporting', 'financial reporting',
                    'financial statements', 'p&l', 'profit and loss', 'balance sheet', 'cash flow',
                    'variance analysis', 'cost accounting', 'management accounting',
                    'consolidation', 'ifrs', 'gaap', 'sox', 'internal controls',
                    'audit', 'internal audit', 'external audit', 'compliance',
                    'tax', 'corporate tax', 'transfer pricing',
                    'sap', 'oracle', 'hyperion', 'cognos', 'anaplan',
                    'excel', 'financial modeling', 'valuation', 'dcf',
                    'm&a', 'due diligence', 'investment', 'portfolio',
                    'controller', 'cfo', 'finance director', 'finance manager'
                ]
            },
            hr: { 
                label: { es: 'Recursos Humanos', en: 'Human Resources', pt: 'Recursos Humanos' },
                keywords: [
                    'human resources', 'hr', 'people', 'people operations',
                    'talent acquisition', 'recruiting', 'sourcing', 'hiring',
                    'employer branding', 'candidate experience',
                    'onboarding', 'offboarding', 'employee lifecycle',
                    'hris', 'workday', 'successfactors', 'sap hr',
                    'payroll', 'compensation', 'benefits', 'total rewards',
                    'performance management', 'talent management', 'succession',
                    'learning', 'l&d', 'training', 'development',
                    'organizational development', 'culture', 'engagement',
                    'employee experience', 'wellbeing',
                    'labor relations', 'employment law', 'compliance',
                    'diversity', 'dei', 'inclusion', 'equity',
                    'hrbp', 'hr business partner', 'chro', 'hr director'
                ]
            },
            marketing: { 
                label: { es: 'Marketing', en: 'Marketing', pt: 'Marketing' },
                keywords: [
                    'marketing', 'marketing manager', 'digital marketing',
                    'content marketing', 'content strategy', 'copywriting',
                    'seo', 'sem', 'ppc', 'google ads', 'facebook ads', 'paid media',
                    'social media', 'community', 'influencer',
                    'email marketing', 'marketing automation', 'hubspot', 'marketo',
                    'crm', 'salesforce', 'customer journey',
                    'analytics', 'google analytics', 'attribution', 'roi', 'roas',
                    'funnel', 'conversion', 'leads', 'mql', 'sql',
                    'brand', 'branding', 'positioning', 'messaging',
                    'campaign', 'launch', 'go-to-market',
                    'pr', 'communications', 'events', 'webinar'
                ]
            },
            sales: { 
                label: { es: 'Ventas / BizDev', en: 'Sales / BizDev', pt: 'Vendas / BizDev' },
                keywords: [
                    'sales', 'sales manager', 'business development', 'bizdev',
                    'account management', 'account executive', 'key account',
                    'enterprise sales', 'b2b', 'b2c', 'saas sales',
                    'solution selling', 'consultative selling', 'challenger sale',
                    'pipeline', 'crm', 'salesforce', 'hubspot',
                    'prospecting', 'cold calling', 'outreach', 'lead generation',
                    'demos', 'presentations', 'proposals', 'rfp',
                    'negotiation', 'closing', 'contract', 'pricing',
                    'quota', 'target', 'forecast', 'territory',
                    'revenue', 'arr', 'mrr', 'growth', 'retention', 'churn',
                    'partnership', 'channel', 'reseller', 'alliance'
                ]
            },
            legal: { 
                label: { es: 'Legal / Compliance', en: 'Legal / Compliance', pt: 'Legal / Compliance' },
                keywords: [
                    'legal', 'lawyer', 'attorney', 'counsel', 'general counsel',
                    'compliance', 'compliance officer', 'cco', 'regulatory',
                    'gdpr', 'data protection', 'privacy', 'dpo',
                    'contracts', 'commercial law', 'corporate law', 'contract management',
                    'employment law', 'labor law',
                    'litigation', 'dispute resolution', 'arbitration', 'mediation',
                    'intellectual property', 'ip', 'patents', 'trademarks',
                    'due diligence', 'm&a', 'corporate governance',
                    'risk management', 'audit', 'internal controls',
                    'policy', 'procedures', 'framework',
                    'aml', 'kyc', 'sanctions', 'financial crime',
                    'banking regulation', 'mifid', 'emir', 'basel', 'solvency'
                ]
            },
            ops: { 
                label: { es: 'Operaciones / Supply Chain', en: 'Operations / Supply Chain', pt: 'Opera√ß√µes / Supply Chain' },
                keywords: [
                    'operations', 'operations manager', 'coo',
                    'logistics', 'supply chain', 'scm',
                    'procurement', 'sourcing', 'purchasing', 'vendor management',
                    'inventory', 'inventory management', 'stock',
                    'warehouse', 'warehousing', 'distribution', 'fulfillment',
                    'transportation', 'fleet', 'shipping', 'last mile',
                    'manufacturing', 'production', 'plant',
                    'quality', 'quality control', 'qc', 'quality assurance',
                    'lean', 'lean manufacturing', 'six sigma', 'tps',
                    'just in time', 'jit', 'kanban',
                    'erp', 'sap', 'oracle', 'planning',
                    'demand planning', 'forecasting', 's&op',
                    'cost optimization', 'efficiency', 'productivity'
                ]
            },
            other: { 
                label: { es: 'Otro (an√°lisis general)', en: 'Other (general analysis)', pt: 'Outro (an√°lise geral)' }, 
                keywords: [] 
            }
        };

        const levels = [
            { id: 'junior', label: { es: 'Junior (0-3 a√±os)', en: 'Junior (0-3 years)', pt: 'J√∫nior (0-3 anos)' }, years: [0, 3] },
            { id: 'mid', label: { es: 'Mid-Level (3-7 a√±os)', en: 'Mid-Level (3-7 years)', pt: 'Pleno (3-7 anos)' }, years: [3, 7] },
            { id: 'senior', label: { es: 'Senior (7-12 a√±os)', en: 'Senior (7-12 years)', pt: 'S√™nior (7-12 anos)' }, years: [7, 12] },
            { id: 'lead', label: { es: 'Lead / Manager (12-18 a√±os)', en: 'Lead / Manager (12-18 years)', pt: 'Lead / Manager (12-18 anos)' }, years: [12, 18] },
            { id: 'director', label: { es: 'Director / Head (18+ a√±os)', en: 'Director / Head (18+ years)', pt: 'Diretor / Head (18+ anos)' }, years: [18, 50] }
        ];

        // --- UTILITIES ---
        function showLoader(text) { 
            document.getElementById('loaderText').textContent = text; 
            document.getElementById('loader').classList.add('active'); 
        }
        function hideLoader() { document.getElementById('loader').classList.remove('active'); }
        function normalize(t) { 
            return t.toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/[^\w\s]/g, ' ')
                .replace(/\s+/g, ' ')
                .trim(); 
        }
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // --- UI ---
        function changeLang(lang) {
            state.lang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => { el.textContent = t(el.dataset.i18n); });
            renderSectors(); 
            renderLevels();
            trackEvent('change_language', 'settings', lang);
        }

        function toggleTheme() {
            const isDark = document.body.dataset.theme === 'dark';
            document.body.dataset.theme = isDark ? '' : 'dark';
            document.getElementById('themeIcon').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
            trackEvent('toggle_theme', 'settings', isDark ? 'light' : 'dark');
        }

        function renderSectors() {
            const grid = document.getElementById('sectorGrid');
            grid.innerHTML = '';
            Object.entries(sectors).forEach(([key, sec]) => {
                const pill = document.createElement('div');
                pill.className = 'option-pill' + (state.sector === key ? ' selected' : '') + (sec.recommended ? ' recommended' : '');
                pill.textContent = sec.label[state.lang];
                pill.onclick = () => { 
                    state.sector = key; 
                    renderSectors(); 
                    trackEvent('select_sector', 'input', key);
                };
                grid.appendChild(pill);
            });
        }

        function renderLevels() {
            const grid = document.getElementById('levelGrid');
            grid.innerHTML = '';
            levels.forEach(lv => {
                const pill = document.createElement('div');
                pill.className = 'option-pill' + (state.level === lv.id ? ' selected' : '');
                pill.textContent = lv.label[state.lang];
                pill.onclick = () => { 
                    state.level = lv.id; 
                    renderLevels(); 
                    trackEvent('select_level', 'input', lv.id);
                };
                grid.appendChild(pill);
            });
        }

        function showInput() {
            document.getElementById('panelInput').classList.add('active');
            document.getElementById('panelResults').classList.remove('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showResults() {
            document.getElementById('panelInput').classList.remove('active');
            document.getElementById('panelResults').classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleJobFit() {
            const card = document.getElementById('jobFitInputCard');
            card.classList.toggle('hidden');
            if (!card.classList.contains('hidden')) {
                card.scrollIntoView({ behavior: 'smooth' });
                trackEvent('open_jobfit', 'feature', 'jobfit');
            }
        }

        function loadExample() {
            document.getElementById('cvInput').value = `RODRIGO VIDAL
PROJECT MANAGER SENIOR | TRANSFORMATION & CHANGE MANAGEMENT
Madrid, Espa√±a ‚Ä¢ rovid25@outlook.com ‚Ä¢ +34 660 234 438

PERFIL PROFESIONAL
Project Manager Senior y L√≠der de Transformaci√≥n con +19 a√±os de trayectoria internacional, forjado en la disciplina de la Armada de Brasil y consolidado liderando proyectos complejos en el sector financiero.

Combino metodolog√≠as anal√≠ticas (Lean Management, Value Stream Mapping, Agile) con un liderazgo humanista que potencia equipos de alto rendimiento. Experto en gesti√≥n de programas de transformaci√≥n, implementaci√≥n de sistemas cr√≠ticos (SWIFT/ISO20022, SAP), offshoring y gesti√≥n del cambio organizacional.

COMPETENCIAS CLAVE
‚Ä¢ Gesti√≥n de Proyectos: Planificaci√≥n estrat√©gica, control presupuestario (+4M EUR), gesti√≥n de riesgos, Agile/Waterfall, MS Project, Azure DevOps, Jira
‚Ä¢ Transformaci√≥n & Mejora Continua: Lean Management, DMAIC, SIPOC, Value Stream Mapping, Kaizen, an√°lisis AS-IS/TO-BE
‚Ä¢ Gesti√≥n del Cambio: Change management, comunicaci√≥n estrat√©gica, formaci√≥n intercultural, offshoring
‚Ä¢ Liderazgo: Equipos hasta 15 personas, stakeholder management, mentoring, comunicaci√≥n ejecutiva
‚Ä¢ Herramientas: Power BI (Certificado), SAP, Excel/Power Query, Claude AI

EXPERIENCIA PROFESIONAL

Strategic Process Manager & Change Lead
ING Espa√±a & Portugal ‚Ä¢ Madrid ‚Ä¢ 2024 ‚Äì Presente
‚Ä¢ Offshoring Manila: Migraci√≥n estrat√©gica al HUB regional (5 personas). Reducci√≥n 80% BAU, SLA >95%, ahorro ‚Ç¨120K/a√±o
‚Ä¢ Fundador del Foro de Expertos en Pagos: Comunidad de 57 profesionales de 5 √°reas. 8 sesiones, 95% satisfacci√≥n
‚Ä¢ Euro Digital: Representante en grupos BCE/BdE. 3+ informes ejecutivos, podcast de divulgaci√≥n

Process Improvement Lead & Treasury Specialist
BME Group (SIX Group) ‚Ä¢ Madrid ‚Ä¢ 2022 ‚Äì 2024
‚Ä¢ Proyecto ISO20022 (TARGET2/CBPR+): Coordinaci√≥n de equipos t√©cnicos, roadmap de 12 meses
‚Ä¢ Value Stream Mapping: Reducci√≥n 20% tiempo de ciclo

Senior Consultant & Transformation Project Manager
Minsait (Indra) ‚Ä¢ Madrid ‚Ä¢ 2021 ‚Äì 2022
‚Ä¢ Consolidaci√≥n plataforma de pagos (+4M EUR): Migraci√≥n internacional a ISO20022
‚Ä¢ Change management para adopci√≥n cross-funcional

Product Owner ‚Äì Treasury & Cash Management
Telef√≥nica ‚Ä¢ Madrid ‚Ä¢ 2019 ‚Äì 2021
‚Ä¢ Proyecto SAP: Gesti√≥n de +200 cuentas bancarias en 20 entidades
‚Ä¢ Banco Interno del Grupo: Creaci√≥n desde cero

Head of Treasury Operations
WiZink Bank ‚Ä¢ Madrid ‚Ä¢ 2015 ‚Äì 2019
‚Ä¢ Cre√© departamento Back Office desde cero (0‚Üí6 personas en 18 meses)
‚Ä¢ Migraci√≥n a Iberclear: Ahorro anual ~‚Ç¨100K

Payment Operations Specialist
Citibank ‚Ä¢ Barcelona ‚Ä¢ 2006 ‚Äì 2015
‚Ä¢ 9 a√±os en operaciones de pagos internacionales

Oficial de Operaciones Log√≠sticas
Armada de Brasil ‚Ä¢ R√≠o de Janeiro ‚Ä¢ 1999 ‚Äì 2006

FORMACI√ìN ACAD√âMICA
‚Ä¢ M√°ster en Project Management ‚Äì OBS Business School (2023)
‚Ä¢ Executive MBA ‚Äì EAE Business School (2018)
‚Ä¢ Grado en Ciencias Pol√≠ticas ‚Äì Universitat de Barcelona (2015)

CERTIFICACIONES
‚Ä¢ Especialista Lean (DMAIC, SIPOC, VSM, Kaizen) ‚Äì FM2S (2024)
‚Ä¢ Power BI & Excel Analytics ‚Äì Bilib (2024)
‚Ä¢ SWIFT Payment Messages Professional ‚Äì SWIFT (2017)

IDIOMAS
‚Ä¢ Espa√±ol: Biling√ºe
‚Ä¢ Portugu√©s: Nativo
‚Ä¢ Ingl√©s: B2+ (Trinity College London)`;
            updateCharCount();
            trackEvent('load_example', 'input', 'example_cv');
        }

        function updateCharCount() {
            const count = document.getElementById('cvInput').value.length;
            document.getElementById('charCount').textContent = count.toLocaleString() + ' caracteres';
        }

        function validateInputs() {
            let valid = true;
            
            if (!state.sector) {
                alert(t('error_sector'));
                return false;
            }
            if (!state.level) {
                alert(t('error_level'));
                return false;
            }
            
            const cv = document.getElementById('cvInput').value.trim();
            const cvGroup = document.getElementById('cvGroup');
            
            if (cv.length < 200) {
                cvGroup.classList.add('error');
                document.getElementById('cvInput').focus();
                return false;
            } else {
                cvGroup.classList.remove('error');
            }
            
            return true;
        }

        // --- CV DATA EXTRACTION ---
        function extractCVData(cvText) {
            const text = cvText;
            const textLower = text.toLowerCase();
            
            // Companies
            const companies = [];
            const knownCompanies = ['ING', 'BME', 'SIX Group', 'Minsait', 'Indra', 'Telef√≥nica', 'WiZink', 'Citibank', 
                'BBVA', 'Santander', 'CaixaBank', 'Sabadell', 'N26', 'Revolut', 'Wise', 'Stripe',
                'Accenture', 'McKinsey', 'BCG', 'Deloitte', 'PwC', 'EY', 'KPMG', 'IBM', 'Capgemini'];
            knownCompanies.forEach(c => { if (textLower.includes(c.toLowerCase())) companies.push(c); });
            
            // Years
            let years = 0;
            const yearsMatch = text.match(/[\+>]?\s*(\d{1,2})\s*\+?\s*(?:a√±os|years|anos)/i);
            if (yearsMatch) years = parseInt(yearsMatch[1]);
            else {
                const yearNums = [...text.matchAll(/\b(19[89]\d|20[0-2]\d)\b/g)].map(m => parseInt(m[1]));
                if (yearNums.length >= 2) years = Math.max(...yearNums) - Math.min(...yearNums);
            }
            
            // Metrics
            const metrics = [];
            const metricPatterns = [
                /\d+\s*%/g,
                /‚Ç¨\s*[\d,.]+[kKmM]?/g,
                /\$\s*[\d,.]+[kKmM]?/g,
                /[\d,.]+\s*(EUR|USD|GBP)/gi,
                /\d+\s*(personas|people|team)/gi,
                /SLA\s*[>‚â•]?\s*\d+%/gi
            ];
            metricPatterns.forEach(p => { const m = text.match(p); if (m) metrics.push(...m); });
            
            // Certifications
            const certifications = [];
            const certKeywords = ['PMP', 'PRINCE2', 'Scrum Master', 'PSM', 'CSM', 'SAFe', 'Lean', 'Six Sigma', 
                'Green Belt', 'Black Belt', 'SWIFT', 'ISO20022', 'Power BI', 'AWS', 'Azure', 'CFA', 'ACCA'];
            certKeywords.forEach(cert => { if (textLower.includes(cert.toLowerCase())) certifications.push(cert); });
            
            // Education
            const education = [];
            if (textLower.match(/\b(phd|doctorado|doctorate)\b/)) education.push('Doctorado');
            if (textLower.match(/\b(executive mba|emba)\b/)) education.push('Executive MBA');
            else if (textLower.match(/\bmba\b/)) education.push('MBA');
            if (textLower.match(/\b(master|m√°ster|mestrado)\b/) && !education.includes('MBA')) education.push('M√°ster');
            if (textLower.match(/\b(grado|degree|licenciatura|bachelor)\b/)) education.push('Grado universitario');
            
            // Languages
            const languages = [];
            if (textLower.match(/espa√±ol|spanish|castellano/)) languages.push('Espa√±ol');
            if (textLower.match(/ingl√©s|english/)) languages.push('Ingl√©s');
            if (textLower.match(/portugu√©s|portuguese/)) languages.push('Portugu√©s');
            if (textLower.match(/franc√©s|french/)) languages.push('Franc√©s');
            if (textLower.match(/alem√°n|german/)) languages.push('Alem√°n');
            
            const englishLevel = textLower.match(/ingl[e√©]s[:\s]*([abc][12][\+]?|native|nativo|fluent|bilingual|biling√ºe)/i);
            
            // Tools
            const tools = [];
            const toolKeywords = ['Jira', 'Confluence', 'MS Project', 'Azure DevOps', 'SAP', 'Power BI', 'Excel', 
                'Tableau', 'SQL', 'Python', 'SWIFT', 'Salesforce', 'ServiceNow', 'Workday'];
            toolKeywords.forEach(tool => { if (textLower.includes(tool.toLowerCase())) tools.push(tool); });
            
            // Methodologies
            const methodologies = [];
            const methKeywords = ['Agile', 'Scrum', 'Kanban', 'Waterfall', 'Lean', 'Six Sigma', 'DMAIC', 'Kaizen', 
                'Value Stream', 'SIPOC', 'Design Thinking', 'SAFe'];
            methKeywords.forEach(m => { if (textLower.includes(m.toLowerCase())) methodologies.push(m); });
            
            // Achievements
            const achievements = [];
            const sentences = text.split(/[.!?]\s+/);
            sentences.forEach(s => {
                if (s.match(/\d+\s*%|\d+\s*(personas|people|‚Ç¨|EUR|USD|\$|proyecto|project|ahorro|saving)/i)) {
                    const clean = s.trim().substring(0, 120);
                    if (clean.length > 20) achievements.push(clean);
                }
            });
            
            // Roles
            const roles = [];
            const rolePatterns = ['Head of', 'Director', 'Manager', 'Lead', 'Senior', 'Specialist', 'Consultant', 'Owner'];
            rolePatterns.forEach(r => { if (text.includes(r)) roles.push(r); });
            
            return {
                companies: [...new Set(companies)].slice(0, 5),
                years,
                metrics: [...new Set(metrics)].slice(0, 8),
                certifications: [...new Set(certifications)],
                education: [...new Set(education)],
                languages,
                englishLevel: englishLevel ? englishLevel[1].toUpperCase() : null,
                tools: [...new Set(tools)],
                methodologies: [...new Set(methodologies)],
                achievements: achievements.slice(0, 5),
                roles: [...new Set(roles)]
            };
        }

        // --- ANALYSIS ENGINE ---
        function analyzeProfile(cvText, sectorKey, levelId) {
            const cv = normalize(cvText);
            const sector = sectors[sectorKey];
            const level = levels.find(l => l.id === levelId);
            const extracted = extractCVData(cvText);
            state.extracted = extracted;
            
            const metrics = {
                experience: calculateExperience(extracted.years, level),
                education: calculateEducation(extracted),
                technical: calculateTechnical(cv, sector, extracted),
                leadership: calculateLeadership(cvText, extracted),
                achievements: calculateAchievements(extracted),
                languages: calculateLanguages(extracted)
            };
            
            const weights = {
                junior: { experience: 0.20, education: 0.25, technical: 0.25, leadership: 0.10, achievements: 0.12, languages: 0.08 },
                mid: { experience: 0.22, education: 0.18, technical: 0.25, leadership: 0.15, achievements: 0.12, languages: 0.08 },
                senior: { experience: 0.22, education: 0.14, technical: 0.22, leadership: 0.20, achievements: 0.14, languages: 0.08 },
                lead: { experience: 0.20, education: 0.12, technical: 0.18, leadership: 0.25, achievements: 0.17, languages: 0.08 },
                director: { experience: 0.18, education: 0.10, technical: 0.15, leadership: 0.28, achievements: 0.20, languages: 0.09 }
            }[levelId];
            
            let score = Object.keys(metrics).reduce((sum, k) => sum + metrics[k] * weights[k], 0);
            
            if (Object.values(metrics).every(v => v >= 70)) score += 4;
            if (Object.values(metrics).some(v => v >= 95)) score += 2;
            if (extracted.years >= 15 && (levelId === 'lead' || levelId === 'director')) score += 3;
            
            score = Math.min(98, Math.round(score));
            
            return {
                score,
                metrics,
                swot: generateSWOT(metrics, extracted, sector, level, state.lang),
                recommendations: generateRecommendations(metrics, extracted, sector, state.lang),
                synthesis: generateSynthesis(score, metrics, extracted, sector, level, state.lang)
            };
        }

        function calculateExperience(years, level) {
            const [min, max] = level.years;
            const expected = (min + max) / 2;
            if (years >= expected * 1.3) return 95;
            if (years >= expected) return 90;
            if (years >= expected * 0.7) return 80;
            if (years >= expected * 0.5) return 65;
            return 50;
        }

        function calculateEducation(extracted) {
            let score = 40;
            if (extracted.education.includes('Doctorado')) score = 100;
            else if (extracted.education.includes('Executive MBA')) score = 95;
            else if (extracted.education.includes('MBA')) score = 90;
            else if (extracted.education.includes('M√°ster')) score = 85;
            else if (extracted.education.includes('Grado universitario')) score = 70;
            
            if (extracted.education.length >= 2) score = Math.min(100, score + 8);
            score = Math.min(100, score + extracted.certifications.length * 4);
            
            return score;
        }

        function calculateTechnical(cvNorm, sector, extracted) {
            if (!sector.keywords.length) return 75;
            
            const matches = sector.keywords.filter(kw => cvNorm.includes(kw.toLowerCase())).length;
            const ratio = matches / Math.min(15, sector.keywords.length);
            let score = Math.min(100, 35 + ratio * 65);
            
            score = Math.min(100, score + extracted.tools.length * 2);
            score = Math.min(100, score + extracted.methodologies.length * 2);
            
            return Math.round(score);
        }

        function calculateLeadership(cvText, extracted) {
            let score = 45;
            const text = cvText.toLowerCase();
            
            const teamMatch = text.match(/(\d+)\s*(personas|people|team|equipo)/i);
            if (teamMatch) {
                const size = parseInt(teamMatch[1]);
                if (size >= 15) score += 25;
                else if (size >= 8) score += 18;
                else if (size >= 4) score += 12;
            }
            
            if (extracted.roles.some(r => r.match(/head|director/i))) score += 15;
            if (extracted.roles.includes('Manager') || extracted.roles.includes('Lead')) score += 10;
            
            const leaderWords = ['led', 'managed', 'founded', 'created', 'built', 'lider√©', 'gestion√©', 'fund√©', 'cre√©', 'constru√≠', 'dirig√≠'];
            const leaderCount = leaderWords.filter(w => text.includes(w)).length;
            score += leaderCount * 3;
            
            if (text.includes('stakeholder')) score += 5;
            if (text.includes('cross-functional') || text.includes('transversal') || text.includes('multidisciplinar')) score += 5;
            
            return Math.min(100, score);
        }

        function calculateAchievements(extracted) {
            let score = 40;
            score += Math.min(30, extracted.metrics.length * 6);
            score += Math.min(20, extracted.achievements.length * 5);
            return Math.min(100, score);
        }

        function calculateLanguages(extracted) {
            let score = 40;
            score += extracted.languages.length * 12;
            
            if (extracted.englishLevel) {
                if (extracted.englishLevel.match(/C[12]|NATIVE|BILINGUAL|BILING√úE/i)) score += 20;
                else if (extracted.englishLevel.match(/B2/i)) score += 12;
                else if (extracted.englishLevel.match(/B1/i)) score += 8;
            }
            
            return Math.min(100, score);
        }

        // --- SWOT GENERATION ---
        function generateSWOT(metrics, extracted, sector, level, lang) {
            const swot = { strengths: [], weaknesses: [], opportunities: [], threats: [] };
            const sectorName = sector.label[lang];
            
            // STRENGTHS
            if (extracted.years >= 15 && extracted.companies.length) {
                swot.strengths.push(`S√≥lida trayectoria de ${extracted.years}+ a√±os con experiencia en ${extracted.companies.slice(0, 3).join(', ')}`);
            } else if (extracted.years >= 10) {
                swot.strengths.push(`${extracted.years}+ a√±os de experiencia profesional consolidada`);
            }
            
            if (extracted.education.length >= 2) {
                swot.strengths.push(`Formaci√≥n acad√©mica destacada: ${extracted.education.join(' + ')}`);
            }
            
            if (extracted.certifications.length >= 2) {
                swot.strengths.push(`Certificaciones profesionales: ${extracted.certifications.slice(0, 4).join(', ')}`);
            }
            
            if (extracted.methodologies.length >= 3) {
                swot.strengths.push(`Dominio de metodolog√≠as: ${extracted.methodologies.slice(0, 4).join(', ')}`);
            }
            
            if (extracted.metrics.length >= 3) {
                swot.strengths.push(`Logros cuantificables demostrados (${extracted.metrics.slice(0, 2).join(', ')})`);
            }
            
            if (extracted.languages.length >= 3) {
                swot.strengths.push(`Perfil multiling√ºe: ${extracted.languages.join(', ')}`);
            }
            
            if (metrics.leadership >= 80) {
                swot.strengths.push('Capacidad demostrada de liderazgo y gesti√≥n de equipos');
            }
            
            while (swot.strengths.length < 3) {
                swot.strengths.push('Perfil estructurado con experiencia en entornos corporativos');
            }
            swot.strengths = swot.strengths.slice(0, 5);
            
            // WEAKNESSES
            if (extracted.englishLevel && extracted.englishLevel.match(/B[12]/i)) {
                swot.weaknesses.push(`Ingl√©s ${extracted.englishLevel}: considera certificaci√≥n C1 para roles internacionales`);
            }
            
            if (metrics.technical < 75) {
                const missing = sector.keywords.filter(kw => !normalize(state.cv).includes(kw.toLowerCase())).slice(0, 3);
                if (missing.length) {
                    swot.weaknesses.push(`Oportunidad de incluir keywords: ${missing.join(', ')}`);
                }
            }
            
            if (metrics.achievements < 70) {
                swot.weaknesses.push('Los logros podr√≠an incluir m√°s m√©tricas cuantificables (%, ‚Ç¨, tiempo)');
            }
            
            if (extracted.tools.length < 3) {
                swot.weaknesses.push('Considera mencionar m√°s herramientas espec√≠ficas del sector');
            }
            
            while (swot.weaknesses.length < 2) {
                swot.weaknesses.push('El CV podr√≠a beneficiarse de keywords adicionales del sector');
            }
            swot.weaknesses = swot.weaknesses.slice(0, 4);
            
            // OPPORTUNITIES
            swot.opportunities.push(`Alta demanda de profesionales senior en ${sectorName}`);
            
            if (extracted.methodologies.some(m => m.match(/lean|agile/i))) {
                swot.opportunities.push('Tu experiencia en Lean/Agile es muy valorada en transformaci√≥n digital');
            }
            
            swot.opportunities.push('El trabajo remoto/h√≠brido ampl√≠a opciones geogr√°ficas');
            swot.opportunities.push('Posibilidad de posicionarte como thought leader en tu especialidad');
            
            // THREATS
            swot.threats.push(`Competencia intensa para roles senior en ${sectorName}`);
            swot.threats.push('La evoluci√≥n tecnol√≥gica requiere actualizaci√≥n continua');
            
            if (level.id === 'lead' || level.id === 'director') {
                swot.threats.push('Expectativas salariales senior pueden limitar opciones en startups');
            }
            
            return swot;
        }

        // --- RECOMMENDATIONS ---
        function generateRecommendations(metrics, extracted, sector, lang) {
            const recs = [];
            const sorted = Object.entries(metrics).sort((a, b) => a[1] - b[1]);
            
            sorted.slice(0, 3).forEach(([key, value], idx) => {
                if (value >= 90) return;
                const priority = idx === 0 ? 'high' : idx === 1 ? 'medium' : 'low';
                
                if (key === 'technical' && value < 85) {
                    const missing = sector.keywords.filter(kw => !normalize(state.cv).includes(kw.toLowerCase())).slice(0, 4);
                    recs.push({ priority, 
                        title: 'Optimizar keywords t√©cnicas',
                        desc: `Tu CV se beneficiar√≠a de incluir: ${missing.join(', ')}. A√±√°delas donde tengas experiencia real.`
                    });
                }
                
                if (key === 'achievements' && value < 80) {
                    recs.push({ priority,
                        title: 'Cuantificar m√°s logros',
                        desc: `Tienes ${extracted.metrics.length} m√©tricas. Objetivo: a√±adir 2-3 m√°s por rol (% mejora, ‚Ç¨ ahorrados, personas lideradas).`
                    });
                }
                
                if (key === 'languages' && value < 75) {
                    recs.push({ priority,
                        title: 'Reforzar perfil de idiomas',
                        desc: extracted.englishLevel ? 
                            `Tu ingl√©s es ${extracted.englishLevel}. Una certificaci√≥n oficial (Cambridge, IELTS) validar√≠a tu nivel para roles internacionales.` :
                            'Indica claramente tu nivel de ingl√©s con certificaci√≥n si es posible.'
                    });
                }
                
                if (key === 'leadership' && value < 80 && (state.level === 'lead' || state.level === 'director')) {
                    recs.push({ priority,
                        title: 'Destacar experiencia de liderazgo',
                        desc: 'Para roles senior: enfatiza tama√±o de equipos, presupuestos gestionados, stakeholders C-level.'
                    });
                }
            });
            
            recs.push({ priority: 'low',
                title: 'Optimizaci√≥n para ATS',
                desc: 'Formato limpio sin tablas complejas. Los sistemas ATS leen mejor texto plano con encabezados claros.'
            });
            
            return recs.slice(0, 4);
        }

        // --- SYNTHESIS ---
        function generateSynthesis(score, metrics, extracted, sector, level, lang) {
            const sectorName = sector.label[lang];
            const levelName = level.label[lang].split(' ')[0];
            
            let quality = score >= 90 ? 'excepcional' : score >= 82 ? 'excelente' : score >= 75 ? 'muy s√≥lido' : score >= 65 ? 's√≥lido' : 'competitivo';
            
            const strongest = Object.entries(metrics).sort((a, b) => b[1] - a[1])[0][0];
            const weakest = Object.entries(metrics).sort((a, b) => a[1] - b[1])[0][0];
            
            const labels = {
                experience: 'experiencia profesional', education: 'formaci√≥n acad√©mica',
                technical: 'competencias t√©cnicas', leadership: 'capacidad de liderazgo',
                achievements: 'logros cuantificables', languages: 'perfil de idiomas'
            };
            
            const companies = extracted.companies.length ? extracted.companies.slice(0, 3).join(', ') : '';
            const certs = extracted.certifications.length ? extracted.certifications.slice(0, 3).join(', ') : '';
            
            return `Perfil profesional <strong>${quality}</strong> para <strong>${sectorName}</strong> a nivel <strong>${levelName}</strong>. ` +
                `Con <strong>${extracted.years}+ a√±os de experiencia</strong>${companies ? ' en ' + companies : ''}, ` +
                `tu punto m√°s destacado es <strong>${labels[strongest]}</strong> (${Math.round(metrics[strongest])}%). ` +
                `${certs ? 'Certificaciones como ' + certs + ' refuerzan tu perfil. ' : ''}` +
                `El √°rea con mayor potencial de mejora es <strong>${labels[weakest]}</strong> (${Math.round(metrics[weakest])}%). ` +
                `Con un <strong>${score}%</strong>, ${score >= 75 ? 'est√°s muy bien posicionado para roles senior.' : 'tienes una base s√≥lida con oportunidades claras de diferenciaci√≥n.'}`;
        }

        // --- JOB FIT ---
        function analyzeJobFit(cvText, jobText) {
            const cvNorm = normalize(cvText);
            const extracted = state.extracted;
            
            const titleMatch = jobText.match(/^(.+?)(?:\n|$)/);
            const jobTitle = titleMatch ? titleMatch[1].trim().substring(0, 60) : 'Puesto';
            
            const requirements = extractJobRequirements(jobText);
            
            const matching = [];
            const gaps = [];
            
            requirements.forEach(req => {
                const reqLower = req.toLowerCase();
                if (cvNorm.includes(reqLower) || checkSynonym(reqLower, cvNorm)) {
                    matching.push(req);
                } else {
                    gaps.push(req);
                }
            });
            
            const matchRatio = requirements.length ? matching.length / requirements.length : 0;
            const profileContrib = state.profile.score * 0.35;
            const matchContrib = matchRatio * 50;
            
            const yearsRequired = (jobText.match(/(\d+)\+?\s*(?:years?|a√±os?)/i) || [])[1];
            let expBonus = 10;
            if (yearsRequired && extracted.years >= parseInt(yearsRequired)) expBonus = 15;
            
            const fitScore = Math.min(95, Math.round(profileContrib + matchContrib + expBonus));
            
            const strategy = `<strong>Para ${escapeHtml(jobTitle)}:</strong> Tu perfil coincide en: ${matching.slice(0, 4).join(', ') || 'varios aspectos'}. ` +
                `${gaps.length ? '√Åreas a reforzar: ' + gaps.slice(0, 3).join(', ') + '. ' : ''}` +
                `<strong>Estrategia:</strong> En tu carta, vincula tus logros (${extracted.metrics.slice(0, 2).join(', ') || 'resultados'}) con los requisitos del puesto.` +
                `${extracted.companies.length ? ' Tu experiencia en ' + extracted.companies[0] + ' es relevante.' : ''}`;
            
            return { score: fitScore, title: jobTitle, matching, gaps: gaps.slice(0, 8), strategy };
        }

        function extractJobRequirements(jobText) {
            const text = jobText.toLowerCase();
            const reqs = new Set();
            
            if (state.sector && sectors[state.sector]) {
                sectors[state.sector].keywords.forEach(kw => {
                    if (text.includes(kw.toLowerCase())) reqs.add(kw);
                });
            }
            
            const common = ['leadership', 'management', 'team', 'strategic', 'analytical', 'communication', 
                'stakeholder', 'agile', 'project management', 'english', 'data-driven', 'process', 
                'compliance', 'risk', 'budget', 'operations', 'customer', 'cross-functional', 'international'];
            common.forEach(c => { if (text.includes(c)) reqs.add(c); });
            
            return [...reqs].slice(0, 25);
        }

        function checkSynonym(term, cvNorm) {
            const synonyms = {
                'leadership': ['liderazgo', 'l√≠der', 'lead', 'dirigir'],
                'management': ['gesti√≥n', 'manager', 'gerencia'],
                'team': ['equipo', 'team', 'personas'],
                'strategic': ['estrat√©gico', 'estrategia'],
                'operations': ['operaciones', 'operacional'],
                'customer': ['cliente', 'customer service'],
                'global': ['internacional', 'multinacional'],
                'improvement': ['mejora', 'optimizaci√≥n', 'kaizen', 'lean']
            };
            
            for (const [key, syns] of Object.entries(synonyms)) {
                if (term.includes(key) || syns.some(s => term.includes(s))) {
                    if (cvNorm.includes(key) || syns.some(s => cvNorm.includes(s))) return true;
                }
            }
            return false;
        }

        // --- MAIN FUNCTIONS ---
        async function runProfileAnalysis() {
            if (!validateInputs()) return;
            
            state.cv = document.getElementById('cvInput').value.trim();
            
            showLoader(t('loading'));
            trackEvent('start_analysis', 'analysis', state.sector);
            
            await new Promise(r => setTimeout(r, 1500));
            
            state.profile = analyzeProfile(state.cv, state.sector, state.level);
            state.jobFit = null;
            
            hideLoader();
            renderResults();
            showResults();
            
            trackEvent('complete_analysis', 'analysis', state.profile.score.toString());
        }

        async function runJobFitAnalysis() {
            state.job = document.getElementById('jobInput').value.trim();
            if (state.job.length < 50) { alert(t('error_job')); return; }
            
            showLoader(t('loading_fit'));
            trackEvent('start_jobfit', 'analysis', 'jobfit');
            
            await new Promise(r => setTimeout(r, 800));
            
            state.jobFit = analyzeJobFit(state.cv, state.job);
            
            hideLoader();
            renderJobFitResults();
            document.getElementById('jobFitInputCard').classList.add('hidden');
            
            trackEvent('complete_jobfit', 'analysis', state.jobFit.score.toString());
        }

        // --- RENDERING ---
        function renderResults() {
            const p = state.profile;
            
            document.getElementById('resultsDate').textContent = new Date().toLocaleDateString(
                state.lang === 'en' ? 'en-US' : state.lang === 'pt' ? 'pt-BR' : 'es-ES',
                { year: 'numeric', month: 'long', day: 'numeric' }
            );
            
            document.getElementById('mainScore').textContent = p.score + '%';
            
            let interp = p.score >= 90 ? 'üèÜ Perfil Excepcional' : p.score >= 82 ? 'üåü Perfil Excelente' : 
                p.score >= 75 ? '‚ú® Perfil Muy S√≥lido' : p.score >= 65 ? 'üëç Perfil S√≥lido' : 'üìà Perfil Competitivo';
            document.getElementById('scoreInterpretation').textContent = interp;
            
            document.getElementById('metaSector').textContent = sectors[state.sector].label[state.lang];
            document.getElementById('metaLevel').textContent = levels.find(l => l.id === state.level).label[state.lang].split(' ')[0];
            document.getElementById('metaYears').textContent = state.extracted.years + '+ ' + t('years');
            
            renderGauge(p.score);
            document.getElementById('synthesisText').innerHTML = p.synthesis;
            renderRadar(p.metrics);
            renderMetricBars(p.metrics);
            
            ['strengths', 'weaknesses', 'opportunities', 'threats'].forEach(key => {
                document.getElementById(key + 'List').innerHTML = p.swot[key].map(item => `<li>${escapeHtml(item)}</li>`).join('');
            });
            
            document.getElementById('recommendationsList').innerHTML = p.recommendations.map((r, i) => `
                <li class="rec-item">
                    <div class="rec-priority ${r.priority}">${i + 1}</div>
                    <div class="rec-content">
                        <div class="rec-title">${escapeHtml(r.title)}</div>
                        <div class="rec-desc">${escapeHtml(r.desc)}</div>
                    </div>
                </li>
            `).join('');
            
            document.getElementById('jobFitResults').classList.add('hidden');
        }

        function renderJobFitResults() {
            const jf = state.jobFit;
            const card = document.getElementById('jobFitResults');
            card.classList.remove('hidden');
            
            document.getElementById('jobFitPosition').textContent = jf.title;
            document.getElementById('jobFitScore').textContent = jf.score + '%';
            
            document.getElementById('matchingSkills').innerHTML = jf.matching.map(s => `<span class="tag match">${escapeHtml(s)}</span>`).join('');
            document.getElementById('gapSkills').innerHTML = jf.gaps.map(s => `<span class="tag gap">${escapeHtml(s)}</span>`).join('');
            
            document.getElementById('fitStrategy').innerHTML = jf.strategy;
            
            card.scrollIntoView({ behavior: 'smooth' });
        }

        function renderGauge(score) {
            const canvas = document.getElementById('scoreGauge');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 200, 200);
            
            ctx.beginPath();
            ctx.arc(100, 100, 85, 0.75 * Math.PI, 2.25 * Math.PI);
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 14;
            ctx.lineCap = 'round';
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(100, 100, 85, 0.75 * Math.PI, 0.75 * Math.PI + (score / 100) * 1.5 * Math.PI);
            const grad = ctx.createLinearGradient(0, 0, 200, 200);
            grad.addColorStop(0, '#d4a853');
            grad.addColorStop(1, '#a37633');
            ctx.strokeStyle = grad;
            ctx.lineWidth = 14;
            ctx.lineCap = 'round';
            ctx.stroke();
        }

        function renderRadar(metrics) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if (state.charts.radar) state.charts.radar.destroy();
            
            const labels = ['Experiencia', 'Formaci√≥n', 'T√©cnicas', 'Liderazgo', 'Logros', 'Idiomas'];
            
            state.charts.radar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels,
                    datasets: [{
                        data: [metrics.experience, metrics.education, metrics.technical, metrics.leadership, metrics.achievements, metrics.languages],
                        backgroundColor: 'rgba(212, 168, 83, 0.2)',
                        borderColor: '#d4a853',
                        borderWidth: 2,
                        pointBackgroundColor: '#d4a853'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { r: { beginAtZero: true, max: 100, ticks: { stepSize: 25, font: { size: 10 } }, pointLabels: { font: { size: 11 } } } }
                }
            });
        }

        function renderMetricBars(metrics) {
            const labels = { experience: 'Experiencia', education: 'Formaci√≥n', technical: 'Skills T√©cnicas', 
                leadership: 'Liderazgo', achievements: 'Logros', languages: 'Idiomas' };
            const colors = { experience: '#d4a853', education: '#a37633', technical: '#059669', 
                leadership: '#7c3aed', achievements: '#0284c7', languages: '#db2777' };
            
            document.getElementById('metricsContainer').innerHTML = Object.entries(metrics).map(([k, v]) => `
                <div class="metric-item">
                    <span class="metric-label">${labels[k]}</span>
                    <div class="metric-bar"><div class="metric-fill" style="width: ${v}%; background: ${colors[k]};"></div></div>
                    <span class="metric-value">${Math.round(v)}%</span>
                </div>
            `).join('');
        }

        // --- SHARING ---
        function shareWhatsApp() {
            const text = `üéØ Acabo de analizar mi perfil profesional y obtuve ${state.profile.score}%\n\n` +
                `Prueba esta herramienta gratis:\n${CONFIG.url}`;
            const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
            trackEvent('share', 'social', 'whatsapp');
        }

        function copyResults() {
            const text = `Mi puntuaci√≥n en RV Profile Studio: ${state.profile.score}%\n` +
                `Sector: ${sectors[state.sector].label[state.lang]}\n` +
                `Nivel: ${levels.find(l => l.id === state.level).label[state.lang]}\n\n` +
                `Analiza tu perfil gratis: ${CONFIG.url}`;
            navigator.clipboard.writeText(text).then(() => {
                alert(t('copied'));
                trackEvent('share', 'copy', 'clipboard');
            });
        }

        // --- PDF ---
        async function generatePDF() {
            showLoader('Generando PDF...');
            trackEvent('download', 'pdf', 'start');
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            const originalTheme = document.body.dataset.theme;
            document.body.dataset.theme = '';
            await new Promise(r => setTimeout(r, 100));
            
            const sections = ['resultsHeader', 'synthesisCard', 'competenciesCard', 'swotCard', 'recommendationsCard'];
            if (!document.getElementById('jobFitResults').classList.contains('hidden')) sections.push('jobFitResults');
            sections.push('resultsFooter');
            
            let y = 10, page = 1;
            
            for (const id of sections) {
                const el = document.getElementById(id);
                if (!el) continue;
                
                try {
                    const canvas = await html2canvas(el, { scale: 2, backgroundColor: '#fefdfb', logging: false });
                    const imgW = 190, imgH = canvas.height * imgW / canvas.width;
                    
                    if (y + imgH > 287) {
                        pdf.setFontSize(8); pdf.setTextColor(150); pdf.text(`${page}`, 105, 292, { align: 'center' });
                        pdf.addPage(); page++; y = 10;
                    }
                    
                    pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 10, y, imgW, imgH);
                    y += imgH + 5;
                } catch (e) { console.error(e); }
            }
            
            pdf.setFontSize(8); pdf.setTextColor(150); pdf.text(`${page}`, 105, 292, { align: 'center' });
            pdf.save(`RV_Profile_${new Date().toISOString().split('T')[0]}.pdf`);
            
            document.body.dataset.theme = originalTheme;
            hideLoader();
            trackEvent('download', 'pdf', 'complete');
        }

        function contact() {
            const subject = encodeURIComponent('Solicitud de Consultor√≠a - RV Profile Studio');
            const body = encodeURIComponent(`Hola,\n\nHe analizado mi perfil con RV Profile Studio y obtuve ${state.profile?.score || '-'}%.\n\nMe gustar√≠a solicitar una sesi√≥n de consultor√≠a personalizada.\n\nSaludos.`);
            window.open(`mailto:${CONFIG.email}?subject=${subject}&body=${body}`);
            trackEvent('contact', 'email', 'consultant');
        }

        function showPrivacy() {
            alert('Pol√≠tica de Privacidad\n\n' +
                '‚Ä¢ No almacenamos ning√∫n dato de tu CV\n' +
                '‚Ä¢ El an√°lisis se realiza localmente en tu navegador\n' +
                '‚Ä¢ Solo usamos Google Analytics para estad√≠sticas an√≥nimas de uso\n' +
                '‚Ä¢ Puedes contactarnos en: ' + CONFIG.email);
        }

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderSectors();
            renderLevels();
            document.getElementById('cvInput').addEventListener('input', updateCharCount);
            
            if (window.matchMedia?.('(prefers-color-scheme: dark)').matches) {
                document.body.dataset.theme = 'dark';
                document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
            }
            
            console.log('RV Profile Studio v' + CONFIG.version + ' - Ready');
            trackEvent('page_view', 'app', 'load');
        });
    </script>
</body>
</html>
